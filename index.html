<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NJTC Portal | Access</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --blue:    #003366;
      --blue2:   #004d99;
      --blue3:   #0066cc;
      --gold:    #f5a623;
      --text:    #1a1a2e;
      --muted:   #6c757d;
      --surface: #ffffff;
      --bg:      #f0f4f8;
      --danger:  #dc3545;
      --radius:  12px;
    }

    body {
      font-family: 'Epilogue', -apple-system, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    /* Background animation */
    .bg-circles {
      position: fixed; inset: 0; overflow: hidden; z-index: 0; pointer-events: none;
    }
    .bg-circle {
      position: absolute; border-radius: 50%; opacity: 0.08;
      background: var(--blue2);
      animation: pulse 8s ease-in-out infinite;
    }
    .bg-circle:nth-child(1) { width: 600px; height: 600px; top: -200px; left: -200px; animation-delay: 0s; }
    .bg-circle:nth-child(2) { width: 400px; height: 400px; bottom: -150px; right: -100px; animation-delay: 2s; }
    .bg-circle:nth-child(3) { width: 300px; height: 300px; top: 50%; left: 60%; animation-delay: 4s; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: .06; }
      50%       { transform: scale(1.15); opacity: .12; }
    }

    /* Card */
    .gate-card {
      position: relative; z-index: 1;
      background: var(--surface);
      border-radius: 20px;
      padding: 2.5rem 2rem;
      width: 100%; max-width: 420px;
      box-shadow: 0 20px 60px rgba(0,51,102,.15), 0 4px 16px rgba(0,0,0,.08);
      animation: slideUp .4s ease;
    }
    @keyframes slideUp {
      from { opacity:0; transform: translateY(30px); }
      to   { opacity:1; transform: translateY(0); }
    }

    /* Logo */
    .gate-logo {
      text-align: center; margin-bottom: 1.75rem;
    }
    .logo-mark {
      display: inline-flex; align-items: center; justify-content: center;
      width: 72px; height: 72px; border-radius: 18px;
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color: #fff; font-size: 1.5rem; font-weight: 900;
      letter-spacing: -1px;
      box-shadow: 0 8px 24px rgba(0,51,102,.3);
      margin-bottom: .75rem;
    }
    .gate-logo h1 { font-size: 1.25rem; font-weight: 800; color: var(--blue); }
    .gate-logo p  { font-size: .8125rem; color: var(--muted); margin-top: .25rem; }

    /* Divider */
    .divider {
      height: 1px; background: #e4e9ed;
      margin: 1.5rem 0;
    }

    /* Input */
    .field-label {
      display: block; font-size: .875rem; font-weight: 600;
      color: var(--text); margin-bottom: .5rem;
    }
    .field-hint {
      font-size: .75rem; color: var(--muted);
      margin-bottom: .75rem; margin-top: -.25rem;
    }
    .code-input {
      width: 100%; padding: .875rem 1rem;
      font-size: 1rem; font-family: inherit;
      border: 2px solid #d1d9e0; border-radius: var(--radius);
      outline: none; transition: border-color .2s, box-shadow .2s;
      letter-spacing: .05em;
    }
    .code-input:focus {
      border-color: var(--blue2);
      box-shadow: 0 0 0 3px rgba(0,77,153,.1);
    }
    .code-input.error { border-color: var(--danger); }

    /* Error */
    .error-msg {
      background: rgba(220,53,69,.08);
      border: 1px solid rgba(220,53,69,.25);
      border-radius: 8px;
      color: var(--danger);
      font-size: .875rem;
      padding: .75rem 1rem;
      margin-top: .75rem;
      display: none;
    }
    .error-msg.show { display: block; }

    /* Button */
    .btn-enter {
      margin-top: 1.25rem;
      width: 100%; padding: .9375rem;
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color: #fff; border: none; border-radius: var(--radius);
      font-size: 1rem; font-weight: 700; font-family: inherit;
      cursor: pointer; transition: all .2s;
      display: flex; align-items: center; justify-content: center; gap: .5rem;
    }
    .btn-enter:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--blue2), var(--blue3));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,51,102,.3);
    }
    .btn-enter:disabled { opacity: .55; cursor: not-allowed; transform: none; }

    /* Spinner */
    .spinner {
      width: 18px; height: 18px; border: 2px solid rgba(255,255,255,.3);
      border-top-color: #fff; border-radius: 50%;
      animation: spin .6s linear infinite;
      display: none;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading .spinner { display: block; }
    .loading .btn-text { display: none; }

    /* Footer note */
    .gate-footer {
      margin-top: 1.5rem; text-align: center;
      font-size: .75rem; color: var(--muted); line-height: 1.6;
    }

    @media (max-width: 480px) {
      .gate-card { margin: 1rem; padding: 2rem 1.5rem; }
    }
  </style>
</head>
<body>

  <div class="bg-circles">
    <div class="bg-circle"></div>
    <div class="bg-circle"></div>
    <div class="bg-circle"></div>
  </div>

  <div class="gate-card">
    <div class="gate-logo">
      <div class="logo-mark">NJTC</div>
      <h1>New Jersey Tutoring Corps</h1>
      <p>Staff Portal â€” Secure Access</p>
    </div>

    <div class="divider"></div>

    <label class="field-label" for="accessCode">Access Code</label>
    <p class="field-hint">Enter your assigned portal code to continue.</p>

    <input
      type="password"
      id="accessCode"
      class="code-input"
      placeholder="e.g., CT-NJTC-XXXX-0000"
      autocomplete="off"
      autocorrect="off"
      spellcheck="false"
    />

    <div class="error-msg" id="errorMsg">
      Invalid access code. Please check your code and try again.
    </div>

    <button class="btn-enter" id="enterBtn">
      <span class="btn-text">Enter Portal</span>
      <div class="spinner"></div>
    </button>

    <div class="gate-footer">
      Access codes are assigned by program administration.<br>
      Questions? Contact your Program Manager.
    </div>
  </div>

  <script src="./auth/auth.js?v=2"></script>
  <script>
    (async () => {
      // If already have a valid session, route immediately
      const existing = await NJTCAuth.currentSession();
      if (existing) {
        route(existing.dept);
        return;
      }

      const input   = document.getElementById('accessCode');
      const btn     = document.getElementById('enterBtn');
      const errMsg  = document.getElementById('errorMsg');

      function setLoading(on) {
        btn.disabled = on;
        btn.classList.toggle('loading', on);
      }

      function showError(msg) {
        errMsg.textContent = msg || 'Invalid access code.';
        errMsg.classList.add('show');
        input.classList.add('error');
      }

      function clearError() {
        errMsg.classList.remove('show');
        input.classList.remove('error');
      }

      async function attempt() {
        const code = input.value.trim();
        if (!code) { showError('Please enter your access code.'); return; }
        clearError();
        setLoading(true);
        try {
          const dept = await NJTCAuth.login(code);
          if (!dept) {
            showError('Invalid access code. Please check and try again.');
            input.select();
          } else {
            route(dept);
          }
        } catch (e) {
          showError(e.message || 'Connection error. Please refresh and retry.');
        } finally {
          setLoading(false);
        }
      }

      btn.addEventListener('click', attempt);
      input.addEventListener('keydown', e => { if (e.key === 'Enter') attempt(); });
      input.addEventListener('input', clearError);
    })();

    function route(dept) {
  const base = '/New-Jersey-Tutoring-Corps-Portal';
  if (dept === 'onsite') {
    window.location.href = base + '/onsite/index.html';
  } else {
    window.location.href = base + '/central/index.html';
  }
}
  </script>
</body>
</html>
