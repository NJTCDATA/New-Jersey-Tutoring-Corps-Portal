<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NJTC Central Team Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --blue:    #003366;
      --blue2:   #004d99;
      --blue3:   #0066cc;
      --gold:    #f5a623;
      --green:   #28a745;
      --orange:  #fd7e14;
      --red:     #dc3545;
      --purple:  #6f42c1;
      --teal:    #20c997;
      --text:    #1a1a2e;
      --muted:   #6c757d;
      --surface: #ffffff;
      --bg:      #f0f4f8;
      --border:  #d1d9e0;
      --radius:  12px;
    }

    body {
      font-family: 'Epilogue', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* â”€â”€ Top Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ct-nav {
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color: #fff;
      padding: 0 1.5rem;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky; top: 0; z-index: 100;
      box-shadow: 0 2px 12px rgba(0,51,102,.3);
    }
    .nav-brand { display: flex; align-items: center; gap: .75rem; }
    .nav-logo  {
      width: 36px; height: 36px; border-radius: 8px;
      background: rgba(255,255,255,.2);
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: .875rem;
    }
    .nav-brand h1 { font-size: 1rem; font-weight: 700; }
    .nav-dept-badge {
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.3);
      border-radius: 20px;
      padding: .25rem .875rem;
      font-size: .75rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .05em;
    }
    .nav-actions { display: flex; align-items: center; gap: .75rem; }
    .session-timer {
      font-size: .75rem; opacity: .7;
    }
    .btn-logout {
      background: rgba(255,255,255,.15);
      border: 1px solid rgba(255,255,255,.3);
      color: #fff; border-radius: 8px;
      padding: .4rem .875rem; font-size: .8125rem;
      font-family: inherit; font-weight: 600;
      cursor: pointer; transition: all .2s;
    }
    .btn-logout:hover { background: rgba(255,255,255,.25); }

    /* â”€â”€ Sidebar + Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ct-layout {
      display: grid;
      grid-template-columns: 220px 1fr;
      min-height: calc(100vh - 60px);
    }
    .ct-sidebar {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 1.25rem 0;
      position: sticky;
      top: 60px;
      height: calc(100vh - 60px);
      overflow-y: auto;
    }
    .sidebar-section-label {
      font-size: .6875rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .08em;
      color: var(--muted); padding: .75rem 1.25rem .375rem;
    }
    .sidebar-link {
      display: flex; align-items: center; gap: .625rem;
      padding: .625rem 1.25rem;
      font-size: .875rem; font-weight: 500; color: var(--text);
      cursor: pointer; transition: all .15s;
      border: none; background: none; width: 100%; text-align: left;
      border-left: 3px solid transparent;
    }
    .sidebar-link:hover { background: rgba(0,51,102,.05); color: var(--blue2); }
    .sidebar-link.active {
      background: rgba(0,51,102,.08);
      color: var(--blue);
      font-weight: 700;
      border-left-color: var(--blue2);
    }
    .sidebar-icon { font-size: 1rem; width: 20px; text-align: center; flex-shrink: 0; }
    .sidebar-divider { height: 1px; background: var(--border); margin: .75rem 1.25rem; }

    /* â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ct-main {
      padding: 1.75rem;
      max-width: 1100px;
    }

    /* Panels */
    .panel { display: none; }
    .panel.active { display: block; }

    /* Page header */
    .page-header {
      margin-bottom: 1.5rem;
    }
    .page-header h2 {
      font-size: 1.5rem; font-weight: 800; color: var(--blue);
      margin-bottom: .25rem;
    }
    .page-header p { font-size: .9375rem; color: var(--muted); }

    /* Cards grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .info-card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 1.25rem;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      transition: box-shadow .2s;
    }
    .info-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,.08); }
    .info-card-icon {
      font-size: 1.75rem; margin-bottom: .75rem;
    }
    .info-card h3 { font-size: 1rem; font-weight: 700; color: var(--blue); margin-bottom: .375rem; }
    .info-card p  { font-size: .875rem; color: var(--muted); line-height: 1.5; }
    .info-card a, .info-card-link {
      display: inline-flex; align-items: center; gap: .375rem;
      margin-top: .75rem;
      font-size: .8125rem; font-weight: 600; color: var(--blue2);
      text-decoration: none; cursor: pointer;
      border: none; background: none; font-family: inherit; padding: 0;
    }
    .info-card a:hover, .info-card-link:hover { color: var(--blue3); }

    /* â”€â”€ KPI Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .kpi-table-wrap {
      background: var(--surface);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow-x: auto;
    }
    .kpi-table {
      width: 100%; border-collapse: collapse; font-size: .875rem;
    }
    .kpi-table th {
      background: var(--blue);
      color: #fff;
      padding: .75rem 1rem;
      text-align: left;
      font-size: .75rem; text-transform: uppercase; letter-spacing: .05em;
      white-space: nowrap;
    }
    .kpi-table td {
      padding: .75rem 1rem;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }
    .kpi-table tr:last-child td { border-bottom: none; }
    .kpi-table tr:nth-child(even) td { background: rgba(0,51,102,.02); }

    .goal-group {
      font-size: .6875rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: .05em; color: var(--muted); display: block;
    }
    .kpi-status {
      display: inline-flex; align-items: center; gap: .375rem;
      font-size: .75rem; font-weight: 700; padding: .25rem .75rem;
      border-radius: 20px; white-space: nowrap;
    }
    .status-met       { background: rgba(40,167,69,.12);  color: #155724; }
    .status-progress  { background: rgba(0,77,153,.1);    color: var(--blue); }
    .status-partial   { background: rgba(253,126,20,.12); color: #7d3c0a; }
    .status-pipeline  { background: rgba(111,66,193,.1);  color: var(--purple); }
    .status-notmet    { background: rgba(220,53,69,.1);   color: #721c24; }

    /* Filter row */
    .kpi-filters {
      display: flex; gap: .75rem; flex-wrap: wrap;
      margin-bottom: 1rem; align-items: center;
    }
    .kpi-filters select, .kpi-filters input {
      padding: .5rem .875rem; font-size: .875rem; font-family: inherit;
      border: 1px solid var(--border); border-radius: 8px;
      outline: none; background: var(--surface);
    }
    .kpi-filters select:focus, .kpi-filters input:focus {
      border-color: var(--blue2);
      box-shadow: 0 0 0 3px rgba(0,77,153,.1);
    }

    /* â”€â”€ Policies Library â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .policy-filters {
      display: flex; gap: .75rem; flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .policy-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    .policy-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      transition: box-shadow .2s;
    }
    .policy-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,.08); }
    .policy-card-top { display: flex; justify-content: space-between; align-items: flex-start; gap: .75rem; margin-bottom: .75rem; }
    .policy-tag {
      font-size: .6875rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: .04em; padding: .25rem .5rem;
      border-radius: 6px; background: rgba(0,51,102,.08); color: var(--blue);
      white-space: nowrap;
    }
    .policy-card h3 { font-size: .9375rem; font-weight: 700; color: var(--text); flex: 1; }
    .policy-meta { font-size: .75rem; color: var(--muted); margin-bottom: .75rem; }
    .policy-desc { font-size: .8125rem; color: #4a5568; line-height: 1.55; margin-bottom: .875rem; }
    .btn-view-policy {
      font-size: .8125rem; font-weight: 600; color: var(--blue2);
      background: none; border: 1px solid var(--blue2);
      padding: .375rem .875rem; border-radius: 8px;
      cursor: pointer; font-family: inherit; transition: all .2s;
      text-decoration: none; display: inline-block;
    }
    .btn-view-policy:hover { background: var(--blue2); color: #fff; }

    /* â”€â”€ Upload Center â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .upload-box {
      background: var(--surface);
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 2.5rem;
      text-align: center;
      margin-bottom: 1.5rem;
      transition: border-color .2s;
    }
    .upload-box:hover { border-color: var(--blue2); }
    .upload-box .upload-icon { font-size: 2.5rem; margin-bottom: .75rem; }
    .upload-box h3 { font-size: 1.125rem; font-weight: 700; color: var(--blue); margin-bottom: .5rem; }
    .upload-box p  { color: var(--muted); font-size: .875rem; margin-bottom: 1.25rem; }
    .btn-primary {
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color: #fff; border: none; border-radius: 10px;
      padding: .75rem 1.5rem; font-size: .9375rem; font-weight: 700;
      font-family: inherit; cursor: pointer; transition: all .2s;
      display: inline-flex; align-items: center; gap: .5rem;
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, var(--blue2), var(--blue3));
      transform: translateY(-1px);
      box-shadow: 0 4px 14px rgba(0,51,102,.3);
    }
    .instructions-box {
      background: rgba(0,51,102,.04);
      border: 1px solid rgba(0,51,102,.15);
      border-radius: var(--radius);
      padding: 1.25rem 1.5rem;
    }
    .instructions-box h4 { font-size: .9375rem; font-weight: 700; color: var(--blue); margin-bottom: .75rem; }
    .instructions-box ol { padding-left: 1.25rem; }
    .instructions-box li { font-size: .875rem; color: var(--text); line-height: 1.7; }

    /* â”€â”€ Concern Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .concern-split {
      display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;
      margin-bottom: 1.5rem;
    }
    .concern-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
    }
    .concern-card h3 { font-size: 1rem; font-weight: 700; margin-bottom: .5rem; }
    .concern-card p  { font-size: .875rem; color: var(--muted); margin-bottom: 1rem; line-height: 1.5; }
    .concern-card .btn-primary { font-size: .875rem; padding: .625rem 1.25rem; }

    /* â”€â”€ Concern Board â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .board-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1rem; flex-wrap: wrap; gap: .75rem;
    }
    .board-note {
      background: rgba(245,166,35,.08);
      border: 1px solid rgba(245,166,35,.3);
      border-radius: 8px; padding: .75rem 1rem;
      font-size: .8125rem; color: #6b4c00;
      margin-bottom: 1.25rem;
    }
    .concern-table-wrap {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow-x: auto;
    }
    .concern-table {
      width: 100%; border-collapse: collapse; font-size: .875rem;
    }
    .concern-table th {
      background: rgba(0,51,102,.06); padding: .75rem 1rem;
      text-align: left; font-size: .75rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .04em; color: var(--blue);
      border-bottom: 2px solid var(--border);
    }
    .concern-table td {
      padding: .75rem 1rem; border-bottom: 1px solid var(--border); vertical-align: top;
    }
    .concern-table tr:last-child td { border-bottom: none; }

    /* â”€â”€ Stats row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem; margin-bottom: 1.5rem;
    }
    .stat-tile {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 1.1rem 1.25rem;
    }
    .stat-tile .tile-label { font-size: .75rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .04em; }
    .stat-tile .tile-value { font-size: 1.75rem; font-weight: 800; color: var(--blue); margin-top: .25rem; }
    .stat-tile .tile-sub   { font-size: .75rem; color: var(--muted); margin-top: .125rem; }

    /* â”€â”€ Dept-gated view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .restricted-banner {
      background: rgba(220,53,69,.06);
      border: 1px solid rgba(220,53,69,.2);
      border-radius: var(--radius);
      padding: 1.5rem;
      text-align: center;
    }
    .restricted-banner .r-icon { font-size: 2.5rem; margin-bottom: .75rem; }
    .restricted-banner h3 { font-weight: 700; color: var(--red); margin-bottom: .5rem; }
    .restricted-banner p  { font-size: .875rem; color: var(--muted); }

    /* â”€â”€ Leadership View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .leadership-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    .leadership-card {
      background: linear-gradient(135deg, var(--blue) 0%, var(--blue2) 100%);
      color: #fff;
      border-radius: var(--radius);
      padding: 1.5rem;
    }
    .leadership-card h3 { font-size: 1.0625rem; font-weight: 700; margin-bottom: .5rem; }
    .leadership-card p  { font-size: .875rem; opacity: .8; line-height: 1.55; }

    /* â”€â”€ Alert boxes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .alert { border-radius: 8px; padding: .875rem 1rem; font-size: .875rem; margin-bottom: 1rem; }
    .alert-info  { background: rgba(0,77,153,.06); border: 1px solid rgba(0,77,153,.2); color: var(--blue); }
    .alert-warn  { background: rgba(253,126,20,.08); border: 1px solid rgba(253,126,20,.25); color: #7d3c0a; }

    /* â”€â”€ Dept color accents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    [data-dept="hr"]           .dept-accent { background: #e53e3e; }
    [data-dept="finance"]      .dept-accent { background: #38a169; }
    [data-dept="programming"]  .dept-accent { background: #3182ce; }
    [data-dept="data"]         .dept-accent { background: var(--purple); }
    [data-dept="training"]     .dept-accent { background: var(--teal); }
    [data-dept="leadership"]   .dept-accent { background: var(--gold); }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      .ct-layout { grid-template-columns: 1fr; }
      .ct-sidebar {
        position: static; height: auto;
        display: flex; flex-wrap: wrap;
        padding: .5rem; gap: .25rem;
        border-right: none; border-bottom: 1px solid var(--border);
      }
      .sidebar-section-label { display: none; }
      .sidebar-divider { display: none; }
      .sidebar-link { width: auto; padding: .5rem .75rem; font-size: .8125rem; }
      .ct-main { padding: 1rem; }
      .concern-split { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- â”€â”€ Top Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="ct-nav">
    <div class="nav-brand">
      <div class="nav-logo">NJTC</div>
      <h1>Central Team Portal</h1>
    </div>
    <div class="nav-actions">
      <span class="nav-dept-badge" id="deptBadge">Loadingâ€¦</span>
      <span class="session-timer" id="sessionTimer"></span>
      <button class="btn-logout" onclick="NJTCAuth.logout()">Sign Out</button>
    </div>
  </nav>

  <!-- â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="ct-layout" id="ctLayout" style="display:none">

    <!-- Sidebar -->
    <aside class="ct-sidebar">
      <span class="sidebar-section-label">Navigation</span>
      <button class="sidebar-link active" data-panel="home" onclick="showPanel('home', this)">
        <span class="sidebar-icon">ğŸ </span> Department Home
      </button>
      <button class="sidebar-link" data-panel="kpi" onclick="showPanel('kpi', this)">
        <span class="sidebar-icon">ğŸ“Š</span> KPI Targets
      </button>
      <button class="sidebar-link" data-panel="policies" onclick="showPanel('policies', this)">
        <span class="sidebar-icon">ğŸ“</span> Policies Library
      </button>

      <div class="sidebar-divider"></div>
      <span class="sidebar-section-label">Reporting</span>

      <button class="sidebar-link" data-panel="concern-program" onclick="showPanel('concern-program', this)">
        <span class="sidebar-icon">âš ï¸</span> Program Concerns
      </button>
      <button class="sidebar-link" data-panel="concern-perf" onclick="showPanel('concern-perf', this)">
        <span class="sidebar-icon">ğŸ‘¤</span> Performance Concerns
      </button>

      <div class="sidebar-divider"></div>
      <span class="sidebar-section-label">Documents</span>

      <button class="sidebar-link" data-panel="upload" onclick="showPanel('upload', this)">
        <span class="sidebar-icon">ğŸ“¤</span> Upload Center
      </button>
    </aside>

    <!-- Main content -->
    <main class="ct-main">

      <!-- â•â• HOME PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel active" id="panel-home">
        <div class="page-header">
          <h2 id="homeTitle">Department Home</h2>
          <p id="homeSubtitle">Quick access to your department's key tools and resources.</p>
        </div>

        <!-- KPI Summary stats -->
        <div class="stats-row" id="kpiSummaryRow">
          <!-- Populated by JS -->
        </div>

        <!-- Quick links â€” populated per dept -->
        <div class="cards-grid" id="quickLinksGrid">
          <!-- Populated by JS -->
        </div>

        <!-- Alert: annual goal banner -->
        <div class="alert alert-info" id="goalAlertBanner">
          <strong>ğŸ¯ Annual Goal Alignment:</strong> All work in the portal connects to NJTC's organizational targets.
          Visit <strong>KPI Targets</strong> to see current progress across all goals.
        </div>
      </div>

      <!-- â•â• KPI PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-kpi">
        <div class="page-header">
          <h2>KPI Targets â€” SY 25-26</h2>
          <p>Read-only view of organizational goal targets. Status reflects mid-cycle reporting.</p>
        </div>
        <div class="kpi-filters">
          <select id="kpiGoalFilter" onchange="filterKPI()">
            <option value="">All Goals</option>
          </select>
          <select id="kpiStatusFilter" onchange="filterKPI()">
            <option value="">All Statuses</option>
            <option value="Met">Met</option>
            <option value="In Progress">In Progress</option>
            <option value="Partially Met">Partially Met</option>
            <option value="Coming Down the Pipeline">Pipeline</option>
            <option value="Has Not Met">Has Not Met</option>
          </select>
          <input type="text" id="kpiSearch" placeholder="Search targetsâ€¦" oninput="filterKPI()" style="min-width:200px">
        </div>
        <div class="kpi-table-wrap">
          <table class="kpi-table" id="kpiTable">
            <thead>
              <tr>
                <th style="width:30%">Annual Goal</th>
                <th>Target</th>
                <th style="width:140px">Mid-Cycle Status</th>
              </tr>
            </thead>
            <tbody id="kpiTbody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- â•â• POLICIES PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-policies">
        <div class="page-header">
          <h2>Policies & Procedures Library</h2>
          <p>Official NJTC documents. Effective dates and department tags shown.</p>
        </div>
        <div class="policy-filters">
          <select id="policyDeptFilter" onchange="filterPolicies()">
            <option value="">All Departments</option>
            <option value="hr">Human Resources</option>
            <option value="finance">Finance</option>
            <option value="programming">Programming</option>
            <option value="data">Data & Evaluation</option>
            <option value="training">Training & Development</option>
            <option value="all">Organization-Wide</option>
          </select>
          <input type="text" id="policySearch" placeholder="Search policiesâ€¦" oninput="filterPolicies()" style="min-width:200px; padding: .5rem .875rem; font-size:.875rem; border:1px solid var(--border); border-radius:8px;">
        </div>
        <div class="policy-grid" id="policyGrid">
          <!-- Populated by JS from /docs/index.json -->
        </div>
        <div id="policyEmpty" style="display:none" class="alert alert-info">No documents match your filter.</div>
      </div>

      <!-- â•â• PROGRAM CONCERNS PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-concern-program">
        <div class="page-header">
          <h2>Program Concern Reporting</h2>
          <p>Submit or review onsite program concerns. All submissions create a tracked GitHub Issue.</p>
        </div>

        <div class="concern-split">
          <div class="concern-card">
            <h3>ğŸ“ Submit a Program Concern</h3>
            <p>Report a concern observed at a site â€” attendance patterns, safety issues, instructional gaps, or escalations. You will be redirected to a pre-filled GitHub Issue form.</p>
            <a class="btn-primary" id="programConcernBtn" href="#" target="_blank" rel="noopener">
              Open Concern Form â†—
            </a>
          </div>
          <div class="concern-card">
            <h3>ğŸ“‹ Escalation Guide</h3>
            <p>Review the protocol for when and how to escalate site concerns. Daily concerns should be logged here. Monthly rollup reports are generated from issue labels.</p>
            <button class="btn-primary" onclick="showPanel('policies', document.querySelector('[data-panel=policies]'))">
              View Escalation Policy
            </button>
          </div>
        </div>

        <div class="board-header">
          <h3 style="font-size:1.0625rem; font-weight:700; color:var(--blue)">Open Concerns Dashboard</h3>
          <a class="btn-primary" id="programIssuesBoardLink" href="#" target="_blank" rel="noopener" style="font-size:.8125rem; padding:.5rem 1rem">
            View Full GitHub Board â†—
          </a>
        </div>
        <div class="board-note">
          â“˜ Concerns are tracked as GitHub Issues. The table below reflects the <strong>index of open issues</strong> â€” click "View Full GitHub Board" to triage, comment, or close items.
        </div>
        <div class="concern-table-wrap">
          <table class="concern-table">
            <thead>
              <tr>
                <th>#</th><th>Site / Region</th><th>Concern Type</th><th>Submitted</th><th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5" style="text-align:center; color:var(--muted); padding:2rem; font-style:italic;">
                  Live issue data loads from GitHub Issues.<br>
                  Click "View Full GitHub Board" above to see and manage all concerns.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- â•â• PERFORMANCE CONCERNS PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-concern-perf">
        <div class="page-header">
          <h2>Performance Concern Reporting</h2>
          <p>Document employee performance conversations. HR-restricted triage available to HR and Leadership only.</p>
        </div>

        <div id="perfHRBoard" style="display:none">
          <!-- HR + Leadership only -->
          <div class="board-header">
            <h3 style="font-size:1.0625rem; font-weight:700; color:var(--blue)">HR Triage Board</h3>
            <a class="btn-primary" id="perfIssuesBoardLink" href="#" target="_blank" rel="noopener" style="font-size:.8125rem; padding:.5rem 1rem">
              View GitHub HR Board â†—
            </a>
          </div>
          <div class="board-note">
            ğŸ”’ HR-restricted view. Performance concern issues are labeled <code>perf-concern</code> and <code>hr-triage</code> in GitHub Issues.
          </div>
          <div class="stats-row">
            <div class="stat-tile"><div class="tile-label">Open</div><div class="tile-value" id="perfOpen">â€”</div><div class="tile-sub">Performance concerns</div></div>
            <div class="stat-tile"><div class="tile-label">On Watch</div><div class="tile-value" id="perfWatch">â€”</div><div class="tile-sub">Employees on watch</div></div>
            <div class="stat-tile"><div class="tile-label">PGP Active</div><div class="tile-value" id="perfPGP">â€”</div><div class="tile-sub">Growth plans active</div></div>
          </div>
        </div>

        <div id="perfFormSection">
          <div class="concern-split">
            <div class="concern-card">
              <h3>ğŸ“ Submit Performance Concern</h3>
              <p>Complete this form each time you have a documented performance conversation with an employee. This creates a tracked record in HR's GitHub Issues board.</p>
              <a class="btn-primary" id="perfConcernBtn" href="#" target="_blank" rel="noopener">
                Open Performance Form â†—
              </a>
            </div>
            <div class="concern-card">
              <h3>ğŸ“Œ What Gets Documented?</h3>
              <p>Attendance concerns, lesson plan deficiencies, overall delivery issues, timecard incidents, and any verbal warning or coaching conversation requiring a record.</p>
              <div class="alert alert-warn" style="margin-top:.75rem; margin-bottom:0">
                Reach out to HR immediately for any situation that may require termination review.
              </div>
            </div>
          </div>
        </div>

        <div id="perfAccessDenied" style="display:none" class="restricted-banner">
          <div class="r-icon">ğŸ”’</div>
          <h3>HR & Leadership Access Only</h3>
          <p>The triage board is restricted to HR and Leadership users. You can still submit performance concerns using the form above.</p>
        </div>
      </div>

      <!-- â•â• UPLOAD CENTER PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-upload">
        <div class="page-header">
          <h2>Document Upload Center</h2>
          <p>Upload PDFs, CSVs, or policy documents to the NJTC docs library via GitHub.</p>
        </div>

        <div class="upload-box">
          <div class="upload-icon">ğŸ“¤</div>
          <h3>Upload via GitHub (Recommended)</h3>
          <p>Click below to open a pre-filled GitHub Issue requesting a document upload.<br>
          A GitHub Action will create a PR and update the docs index automatically.</p>
          <a class="btn-primary" id="uploadIssueBtn" href="#" target="_blank" rel="noopener">
            Request Document Upload â†—
          </a>
        </div>

        <div class="instructions-box">
          <h4>How to Upload a Document</h4>
          <ol>
            <li>Click "Request Document Upload" above.</li>
            <li>Fill in: document title, department, effective date, and description.</li>
            <li>Attach the file to the GitHub Issue.</li>
            <li>Submit the issue. A GitHub Action will create a Pull Request within minutes.</li>
            <li>An admin approves the PR â†’ document appears in the Policies Library automatically.</li>
          </ol>
        </div>
      </div>

    </main>
  </div>

  <!-- Access denied fallback (shown before session verified) -->
  <div id="loadingScreen" style="position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:9999;">
    <div style="text-align:center">
      <div style="font-size:2rem;margin-bottom:.75rem">ğŸ”</div>
      <p style="color:var(--muted);font-size:.9375rem">Verifying accessâ€¦</p>
    </div>
  </div>

  <script src="../auth/auth.js"></script>
<script src="../auth/central-guard.js"></script>
  <script>

  // â”€â”€ Dept config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DEPT_CONFIG = {
    hr: {
      label: 'Human Resources',
      emoji: 'ğŸ‘”',
      subtitle: 'Protecting the organization and our people.',
      quickLinks: [
        { icon: 'ğŸ“‹', title: 'Performance Concern Form', desc: 'Document a performance conversation.', action: () => showPanel('concern-perf', document.querySelector('[data-panel="concern-perf"]')) },
        { icon: 'ğŸ“', title: 'HR Policies', desc: 'Access all HR policies and procedures.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“Š', title: 'KPI: Culture Goals', desc: 'Staff retention and diversity targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'Review escalations requiring HR action.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
      ]
    },
    finance: {
      label: 'Finance',
      emoji: 'ğŸ’°',
      subtitle: 'Maintaining fiscal health and accountability.',
      quickLinks: [
        { icon: 'ğŸ“Š', title: 'KPI: Funding Goals', desc: 'Philanthropic and fee-for-service targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“', title: 'Finance Policies', desc: 'Budget procedures and financial guidelines.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“¤', title: 'Upload Reports', desc: 'Upload financial reports to the docs library.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
      ]
    },
    programming: {
      label: 'Programming',
      emoji: 'ğŸ¯',
      subtitle: 'Delivering high-quality instructional programs.',
      quickLinks: [
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'Log and review site-level concerns.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
        { icon: 'ğŸ“Š', title: 'KPI: Scholar Impact', desc: 'Scholar growth and site targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“', title: 'Programming Policies', desc: 'Site operations and program procedures.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“¤', title: 'Upload Site Docs', desc: 'Submit program-related documents.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
      ]
    },
    data: {
      label: 'Data & Evaluation',
      emoji: 'ğŸ“ˆ',
      subtitle: 'Driving decisions through rigorous data.',
      quickLinks: [
        { icon: 'ğŸ“Š', title: 'Full KPI Dashboard', desc: 'Review all organizational targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“¤', title: 'Upload Data Reports', desc: 'Submit evaluation CSVs or reports.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
        { icon: 'ğŸ“', title: 'Data Governance Docs', desc: 'Data policies and reporting frameworks.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
      ]
    },
    training: {
      label: 'Training & Development',
      emoji: 'ğŸ“',
      subtitle: 'Building staff capacity and growth.',
      quickLinks: [
        { icon: 'ğŸ“', title: 'Training Materials', desc: 'Policies and procedures for PD.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“Š', title: 'KPI: Pipeline Goals', desc: 'Educator pipeline and apprenticeship targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“¤', title: 'Upload PD Docs', desc: 'Submit training materials.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'Training-related site concerns.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
      ]
    },
    leadership: {
      label: 'Leadership',
      emoji: 'â­',
      subtitle: 'Organizational oversight and strategic direction.',
      quickLinks: [
        { icon: 'ğŸ“Š', title: 'KPI Targets', desc: 'Full organizational goal overview.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'All open program concern issues.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
        { icon: 'ğŸ‘¤', title: 'Performance Board', desc: 'HR triage board â€” full access.', action: () => showPanel('concern-perf', document.querySelector('[data-panel="concern-perf"]')) },
        { icon: 'ğŸ“', title: 'All Policies', desc: 'Organization-wide policy library.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
      ]
    }
  };

  // â”€â”€ KPI Data (from CSV) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const KPI_DATA = [
    { goal: 'Increase Impact on Scholars', target: 'Serve 2,000 scholars annually by 2026', status: 'Partially Met' },
    { goal: 'Increase Impact on Scholars', target: 'Serve 35 sites annually by 2026', status: 'Met' },
    { goal: 'Increase Impact on Scholars', target: 'Placement Level Change: 80% of scholars advancing a level in math or ELA', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: 'Math: 20% increase of scholars reaching grade-level proficiency', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: 'ELA: 20% increase of scholars reaching grade-level proficiency', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: 'Gap Closing: 35% decrease in scholars 2+ grade levels below', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: '80% of scholars self-report increased confidence in ELA', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: '80% of scholars self-report increased confidence in Math', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: '92% of onsite staff observe scholar growth', status: 'In Progress' },
    { goal: 'Educator Pipeline', target: '40 tutor apprentices for SY 25-26', status: 'In Progress' },
    { goal: 'Educator Pipeline', target: 'Secure 1 DOL grant to expand apprenticeship program', status: 'Met' },
    { goal: 'Educator Pipeline', target: '4 NJTC apprentices join Teacher Apprenticeship Network (TAN) in 2026', status: 'Coming Down the Pipeline' },
    { goal: 'Fee-for-Service Growth', target: '35 SY sites â€” all fee-for-service', status: 'Met' },
    { goal: 'Fee-for-Service Growth', target: 'Secure 3 new low-cost pilot customers using new grant funds', status: 'In Progress' },
    { goal: 'Fee-for-Service Growth', target: '75% of sites cover full fee-for-service', status: 'Met' },
    { goal: 'Fee-for-Service Growth', target: 'Add 1 additional out-of-state customer', status: 'Met' },
    { goal: 'Fee-for-Service Growth', target: 'Apply to at least 10 local/regional RFPs annually', status: 'Partially Met' },
    { goal: 'Funding', target: 'Identify and apply to 2 new multi-year or $500K+ funding opportunities', status: 'Met' },
    { goal: 'Funding', target: 'Secure $850,000 in philanthropic funds', status: 'Met' },
    { goal: 'Funding', target: 'Secure new philanthropic partners totaling $200K', status: 'Has Not Met' },
    { goal: 'Funding', target: 'Secure support from FY27 State budget', status: 'Coming Down the Pipeline' },
    { goal: 'Financial Health', target: 'Maintain $500K in money market by end of 2025', status: 'Met' },
    { goal: 'Board Development', target: 'At least 1 board member introduction per member (15 total) to partners/donors', status: 'In Progress' },
    { goal: 'Board Development', target: 'Maintain 100% board giving; increase total by 10%', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: 'Revised performance evaluation system in place by November 2025', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: 'KPI Dashboard 100% operational by October 2025', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: '2025-2026 Program Evaluation completed by August 2026', status: 'Coming Down the Pipeline' },
    { goal: 'Systems & Infrastructure', target: 'NJTC Annual Report sent to stakeholders by December 2025', status: 'Partially Met' },
    { goal: 'Systems & Infrastructure', target: 'Data Governance documented for all internal reporting by December 2025', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: 'Annual Budgeting process completed by August 1, 2026', status: 'Coming Down the Pipeline' },
    { goal: 'Systems & Infrastructure', target: 'Leadership completes Mid-Year and End-of-Year retreat', status: 'Coming Down the Pipeline' },
    { goal: 'Partner Experience', target: '90% customer satisfaction at end of SY 25-26', status: 'In Progress' },
    { goal: 'Partner Experience', target: 'Receive 3 referrals from partners', status: 'Met' },
    { goal: 'Partner Experience', target: '50% retention rate for school partners', status: 'Coming Down the Pipeline' },
    { goal: 'Culture', target: '80% annual core staff retention', status: 'Met' },
    { goal: 'Culture', target: '60% annual on-site staff retention', status: 'Has Not Met' },
    { goal: 'Culture', target: 'Increase diversity of tutors to mirror student diversity', status: 'Met' },
    { goal: 'Culture', target: 'Host 2 in-person events for central team (Winter and Summer)', status: 'Partially Met' },
    { goal: 'Brand Growth', target: '10 local media hits per year', status: 'Met' },
    { goal: 'Brand Growth', target: 'Attend 5 local education/non-profit conferences; speak at 2', status: 'Met' },
    { goal: 'Brand Growth', target: 'Participate in 3 national conferences with presentations at 2', status: 'Met' },
    { goal: 'Brand Growth', target: 'Increase social media followers by 20% in aggregate', status: 'Coming Down the Pipeline' },
    { goal: 'Brand Growth', target: 'Meet with at least 7 education organizations across NJ', status: 'In Progress' },
    { goal: 'Brand Growth', target: 'Attend 5 South Jersey Chamber events', status: 'Partially Met' },
  ];

  // Placeholder docs â€” replace with /docs/index.json fetch
  const DOCS_DATA = [
    { title: 'Employee Handbook', dept: 'hr', tag: 'HR', effectiveDate: 'Aug 2025', desc: 'Full NJTC employee handbook covering policies, procedures, and expectations.', file: '/docs/employee-handbook.pdf' },
    { title: 'Data Governance Framework', dept: 'data', tag: 'Data & Evaluation', effectiveDate: 'Dec 2025', desc: 'Internal reporting standards, data ownership, and governance workflows.', file: '/docs/data-governance.pdf' },
    { title: 'Performance Evaluation System', dept: 'hr', tag: 'HR', effectiveDate: 'Nov 2025', desc: 'Revised performance evaluation rubrics and process documentation.', file: '/docs/perf-eval-system.pdf' },
    { title: 'Program Concern Escalation Protocol', dept: 'programming', tag: 'Programming', effectiveDate: 'Sep 2025', desc: 'Step-by-step guide for escalating site-level program concerns.', file: '/docs/escalation-protocol.pdf' },
    { title: 'Budget & Financial Controls', dept: 'finance', tag: 'Finance', effectiveDate: 'Aug 2025', desc: 'Budget procedures, reimbursement policy, and financial accountability guidelines.', file: '/docs/budget-controls.pdf' },
    { title: 'Training & PD Calendar', dept: 'training', tag: 'Training', effectiveDate: 'Sep 2025', desc: 'Required professional development schedule and compliance tracking.', file: '/docs/pd-calendar.pdf' },
  ];

  // â”€â”€ GitHub config placeholders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const GITHUB = {
    repo: 'NJTCDATA/New-Jersey-Tutoring-Corps-Portal', // e.g. njtcdata/njtc-portal
    get issuesUrl() { return `https://github.com/${this.repo}/issues`; },
    get programConcernNew() {
      return `https://github.com/${this.repo}/issues/new?template=program-concern.yml&labels=program-concern`;
    },
    get perfConcernNew() {
      return `https://github.com/${this.repo}/issues/new?template=performance-concern.yml&labels=perf-concern,hr-triage`;
    },
    get uploadIssueNew() {
      return `https://github.com/${this.repo}/issues/new?template=doc-upload-request.yml&labels=doc-upload`;
    },
    get programBoard() {
      return `https://github.com/${this.repo}/issues?q=is%3Aissue+is%3Aopen+label%3Aprogram-concern`;
    },
    get perfBoard() {
      return `https://github.com/${this.repo}/issues?q=is%3Aissue+is%3Aopen+label%3Aperf-concern`;
    }
  };

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function statusClass(s) {
    switch(s) {
      case 'Met':                      return 'status-met';
      case 'In Progress':              return 'status-progress';
      case 'Partially Met':            return 'status-partial';
      case 'Coming Down the Pipeline': return 'status-pipeline';
      case 'Has Not Met':              return 'status-notmet';
      default:                         return 'status-progress';
    }
  }
  function statusEmoji(s) {
    switch(s) {
      case 'Met':                      return 'âœ…';
      case 'In Progress':              return 'ğŸ”µ';
      case 'Partially Met':            return 'ğŸŸ ';
      case 'Coming Down the Pipeline': return 'ğŸŸ£';
      case 'Has Not Met':              return 'ğŸ”´';
      default:                         return 'âšª';
    }
  }

  // â”€â”€ Panel switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showPanel(id, linkEl) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
    const panel = document.getElementById('panel-' + id);
    if (panel) panel.classList.add('active');
    if (linkEl) linkEl.classList.add('active');
    else {
      const btn = document.querySelector(`[data-panel="${id}"]`);
      if (btn) btn.classList.add('active');
    }
  }

  // â”€â”€ Build KPI table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildKPI() {
    const goals = [...new Set(KPI_DATA.map(k => k.goal))];
    const sel = document.getElementById('kpiGoalFilter');
    goals.forEach(g => {
      const o = document.createElement('option');
      o.value = g; o.textContent = g;
      sel.appendChild(o);
    });
    renderKPI(KPI_DATA);
  }

  function renderKPI(data) {
    const tbody = document.getElementById('kpiTbody');
    tbody.innerHTML = data.map(row => `
      <tr>
        <td><span class="goal-group">${row.goal}</span></td>
        <td>${row.target}</td>
        <td><span class="kpi-status ${statusClass(row.status)}">${statusEmoji(row.status)} ${row.status}</span></td>
      </tr>
    `).join('');
  }

  function filterKPI() {
    const goalF  = document.getElementById('kpiGoalFilter').value;
    const statF  = document.getElementById('kpiStatusFilter').value;
    const search = document.getElementById('kpiSearch').value.toLowerCase();
    const filtered = KPI_DATA.filter(r =>
      (!goalF  || r.goal === goalF) &&
      (!statF  || r.status === statF) &&
      (!search || r.target.toLowerCase().includes(search) || r.goal.toLowerCase().includes(search))
    );
    renderKPI(filtered);
  }

  // â”€â”€ KPI summary stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildKPISummary() {
    const counts = { Met: 0, 'In Progress': 0, 'Partially Met': 0, 'Coming Down the Pipeline': 0, 'Has Not Met': 0 };
    KPI_DATA.forEach(r => counts[r.status] = (counts[r.status] || 0) + 1);
    const row = document.getElementById('kpiSummaryRow');
    row.innerHTML = [
      { label: 'Goals Met', value: counts['Met'],          sub: 'On track',  cls: 'status-met' },
      { label: 'In Progress', value: counts['In Progress'], sub: 'Active',    cls: 'status-progress' },
      { label: 'Partial', value: counts['Partially Met'],   sub: 'Needs attention', cls: 'status-partial' },
      { label: 'Has Not Met', value: counts['Has Not Met'], sub: 'Review needed', cls: 'status-notmet' },
    ].map(t => `
      <div class="stat-tile">
        <div class="tile-label">${t.label}</div>
        <div class="tile-value" style="font-size:1.5rem">${t.value}</div>
        <div class="tile-sub">${t.sub}</div>
      </div>
    `).join('');
  }

  // â”€â”€ Build policies â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function buildPolicies() {
    // Try to fetch live docs/index.json; fall back to DOCS_DATA
    let docs = DOCS_DATA;
    try {
      const res = await fetch('/docs/index.json?v=' + Date.now());
      if (res.ok) docs = await res.json();
    } catch { /* use static fallback */ }
    renderPolicies(docs);
  }

  function renderPolicies(docs) {
    window._allDocs = docs;
    filterPolicies();
  }

  function filterPolicies() {
    const docs = window._allDocs || DOCS_DATA;
    const deptF  = document.getElementById('policyDeptFilter').value;
    const search = document.getElementById('policySearch').value.toLowerCase();
    const filtered = docs.filter(d =>
      (!deptF  || d.dept === deptF) &&
      (!search || d.title.toLowerCase().includes(search) || (d.desc||'').toLowerCase().includes(search))
    );
    const grid = document.getElementById('policyGrid');
    const empty = document.getElementById('policyEmpty');
    if (!filtered.length) {
      grid.innerHTML = '';
      empty.style.display = 'block';
      return;
    }
    empty.style.display = 'none';
    grid.innerHTML = filtered.map(d => `
      <div class="policy-card">
        <div class="policy-card-top">
          <h3>${d.title}</h3>
          <span class="policy-tag">${d.tag || d.dept}</span>
        </div>
        <div class="policy-meta">Effective: ${d.effectiveDate || 'N/A'} &nbsp;Â·&nbsp; Dept: ${d.dept}</div>
        <p class="policy-desc">${d.desc || ''}</p>
        <a class="btn-view-policy" href="${d.file}" target="_blank" rel="noopener">
          View Document â†—
        </a>
      </div>
    `).join('');
  }

  // â”€â”€ Build dept home quick links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildHomeQuickLinks(dept) {
    const config = DEPT_CONFIG[dept] || DEPT_CONFIG['programming'];
    document.getElementById('homeTitle').textContent = config.emoji + ' ' + config.label + ' Home';
    document.getElementById('homeSubtitle').textContent = config.subtitle;

    const grid = document.getElementById('quickLinksGrid');
    grid.innerHTML = config.quickLinks.map(link => `
      <div class="info-card">
        <div class="info-card-icon">${link.icon}</div>
        <h3>${link.title}</h3>
        <p>${link.desc}</p>
        <button class="info-card-link" onclick="(${link.action.toString()})()">
          Go â†’ 
        </button>
      </div>
    `).join('');
  }

  // â”€â”€ Perf concern dept gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setupPerfSection(dept) {
    const canSeeBoard = ['hr', 'leadership'].includes(dept);
    document.getElementById('perfHRBoard').style.display    = canSeeBoard ? 'block' : 'none';
    document.getElementById('perfAccessDenied').style.display = canSeeBoard ? 'none' : 'none'; // form always visible
    document.getElementById('perfFormSection').style.display = 'block';
  }

  // â”€â”€ Session timer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startSessionTimer(exp) {
    function update() {
      const left = exp - Date.now();
      if (left <= 0) { NJTCAuth.logout(); return; }
      const h = Math.floor(left / 3600000);
      const m = Math.floor((left % 3600000) / 60000);
      document.getElementById('sessionTimer').textContent = `Session: ${h}h ${m}m`;
    }
    update();
    setInterval(update, 60000);
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function init() {
    // Wait for central-guard.js to set window.NJTC_SESSION
    await new Promise(resolve => {
      if (window.NJTC_SESSION) { resolve(); return; }
      const t = setInterval(() => {
        if (window.NJTC_SESSION) { clearInterval(t); resolve(); }
      }, 50);
      setTimeout(() => { clearInterval(t); resolve(); }, 3000);
    });

    const session = window.NJTC_SESSION;
    if (!session) return; // guard already redirected

    const dept = session.dept;
    const config = DEPT_CONFIG[dept] || {};

    // Update badge
    document.getElementById('deptBadge').textContent = config.label || dept.toUpperCase();

    // Session timer
    startSessionTimer(session.exp);

    // Build content
    buildHomeQuickLinks(dept);
    buildKPISummary();
    buildKPI();
    buildPolicies();
    setupPerfSection(dept);

    // Wire GitHub links
    document.getElementById('programConcernBtn').href   = GITHUB.programConcernNew;
    document.getElementById('perfConcernBtn').href      = GITHUB.perfConcernNew;
    document.getElementById('uploadIssueBtn').href      = GITHUB.uploadIssueNew;
    document.getElementById('programIssuesBoardLink').href = GITHUB.programBoard;
    if (document.getElementById('perfIssuesBoardLink'))
      document.getElementById('perfIssuesBoardLink').href = GITHUB.perfBoard;

    // Show UI
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('ctLayout').style.display = 'grid';
  }

  init();
  </script>
</body>
</html>
