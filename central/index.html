<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NJTC Central Team Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --blue:    #003366;
      --blue2:   #004d99;
      --blue3:   #0066cc;
      --gold:    #f5a623;
      --green:   #28a745;
      --orange:  #fd7e14;
      --red:     #dc3545;
      --purple:  #6f42c1;
      --teal:    #20c997;
      --text:    #1a1a2e;
      --muted:   #6c757d;
      --surface: #ffffff;
      --bg:      #f0f4f8;
      --border:  #d1d9e0;
      --radius:  12px;
    }

    body {
      font-family: 'Epilogue', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* â”€â”€ Top Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ct-nav {
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color: #fff;
      padding: 0 1.5rem;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky; top: 0; z-index: 100;
      box-shadow: 0 2px 12px rgba(0,51,102,.3);
    }
    .nav-brand { display: flex; align-items: center; gap: .75rem; }
    .nav-logo  {
      width: 36px; height: 36px; border-radius: 8px;
      background: rgba(255,255,255,.2);
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: .875rem;
    }
    .nav-brand h1 { font-size: 1rem; font-weight: 700; }
    .nav-dept-badge {
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.3);
      border-radius: 20px;
      padding: .25rem .875rem;
      font-size: .75rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .05em;
    }
    .nav-actions { display: flex; align-items: center; gap: .75rem; }
    .session-timer {
      font-size: .75rem; opacity: .7;
    }
    .btn-logout {
      background: rgba(255,255,255,.15);
      border: 1px solid rgba(255,255,255,.3);
      color: #fff; border-radius: 8px;
      padding: .4rem .875rem; font-size: .8125rem;
      font-family: inherit; font-weight: 600;
      cursor: pointer; transition: all .2s;
    }
    .btn-logout:hover { background: rgba(255,255,255,.25); }

    /* â”€â”€ Sidebar + Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ct-layout {
      display: grid;
      grid-template-columns: 220px 1fr;
      min-height: calc(100vh - 60px);
    }
    .ct-sidebar {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 1.25rem 0;
      position: sticky;
      top: 60px;
      height: calc(100vh - 60px);
      overflow-y: auto;
    }
    .sidebar-section-label {
      font-size: .6875rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .08em;
      color: var(--muted); padding: .75rem 1.25rem .375rem;
    }
    .sidebar-link {
      display: flex; align-items: center; gap: .625rem;
      padding: .625rem 1.25rem;
      font-size: .875rem; font-weight: 500; color: var(--text);
      cursor: pointer; transition: all .15s;
      border: none; background: none; width: 100%; text-align: left;
      border-left: 3px solid transparent;
    }
    .sidebar-link:hover { background: rgba(0,51,102,.05); color: var(--blue2); }
    .sidebar-link.active {
      background: rgba(0,51,102,.08);
      color: var(--blue);
      font-weight: 700;
      border-left-color: var(--blue2);
    }
    .sidebar-icon { font-size: 1rem; width: 20px; text-align: center; flex-shrink: 0; }
    .sidebar-divider { height: 1px; background: var(--border); margin: .75rem 1.25rem; }

    /* â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ct-main {
      padding: 1.75rem;
      max-width: 1100px;
    }

    /* Panels */
    .panel { display: none; }
    .panel.active { display: block; }

    /* Page header */
    .page-header {
      margin-bottom: 1.5rem;
    }
    .page-header h2 {
      font-size: 1.5rem; font-weight: 800; color: var(--blue);
      margin-bottom: .25rem;
    }
    .page-header p { font-size: .9375rem; color: var(--muted); }

    /* Cards grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .info-card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 1.25rem;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      transition: box-shadow .2s;
    }
    .info-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,.08); }
    .info-card-icon {
      font-size: 1.75rem; margin-bottom: .75rem;
    }
    .info-card h3 { font-size: 1rem; font-weight: 700; color: var(--blue); margin-bottom: .375rem; }
    .info-card p  { font-size: .875rem; color: var(--muted); line-height: 1.5; }
    .info-card a, .info-card-link {
      display: inline-flex; align-items: center; gap: .375rem;
      margin-top: .75rem;
      font-size: .8125rem; font-weight: 600; color: var(--blue2);
      text-decoration: none; cursor: pointer;
      border: none; background: none; font-family: inherit; padding: 0;
    }
    .info-card a:hover, .info-card-link:hover { color: var(--blue3); }

    /* â”€â”€ KPI Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .kpi-table-wrap {
      background: var(--surface);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow-x: auto;
    }
    .kpi-table {
      width: 100%; border-collapse: collapse; font-size: .875rem;
    }
    .kpi-table th {
      background: var(--blue);
      color: #fff;
      padding: .75rem 1rem;
      text-align: left;
      font-size: .75rem; text-transform: uppercase; letter-spacing: .05em;
      white-space: nowrap;
    }
    .kpi-table td {
      padding: .75rem 1rem;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }
    .kpi-table tr:last-child td { border-bottom: none; }
    .kpi-table tr:nth-child(even) td { background: rgba(0,51,102,.02); }

    .goal-group {
      font-size: .6875rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: .05em; color: var(--muted); display: block;
    }
    .kpi-status {
      display: inline-flex; align-items: center; gap: .375rem;
      font-size: .75rem; font-weight: 700; padding: .25rem .75rem;
      border-radius: 20px; white-space: nowrap;
    }
    .status-met       { background: rgba(40,167,69,.12);  color: #155724; }
    .status-progress  { background: rgba(0,77,153,.1);    color: var(--blue); }
    .status-partial   { background: rgba(253,126,20,.12); color: #7d3c0a; }
    .status-pipeline  { background: rgba(111,66,193,.1);  color: var(--purple); }
    .status-notmet    { background: rgba(220,53,69,.1);   color: #721c24; }

    /* Filter row */
    .kpi-filters {
      display: flex; gap: .75rem; flex-wrap: wrap;
      margin-bottom: 1rem; align-items: center;
    }
    .kpi-filters select, .kpi-filters input {
      padding: .5rem .875rem; font-size: .875rem; font-family: inherit;
      border: 1px solid var(--border); border-radius: 8px;
      outline: none; background: var(--surface);
    }
    .kpi-filters select:focus, .kpi-filters input:focus {
      border-color: var(--blue2);
      box-shadow: 0 0 0 3px rgba(0,77,153,.1);
    }

    /* â”€â”€ Policies Library â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .policy-filters {
      display: flex; gap: .75rem; flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .policy-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    .policy-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      transition: box-shadow .2s;
    }
    .policy-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,.08); }
    .policy-card-top { display: flex; justify-content: space-between; align-items: flex-start; gap: .75rem; margin-bottom: .75rem; }
    .policy-tag {
      font-size: .6875rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: .04em; padding: .25rem .5rem;
      border-radius: 6px; background: rgba(0,51,102,.08); color: var(--blue);
      white-space: nowrap;
    }
    .policy-card h3 { font-size: .9375rem; font-weight: 700; color: var(--text); flex: 1; }
    .policy-meta { font-size: .75rem; color: var(--muted); margin-bottom: .75rem; }
    .policy-desc { font-size: .8125rem; color: #4a5568; line-height: 1.55; margin-bottom: .875rem; }
    .btn-view-policy {
      font-size: .8125rem; font-weight: 600; color: var(--blue2);
      background: none; border: 1px solid var(--blue2);
      padding: .375rem .875rem; border-radius: 8px;
      cursor: pointer; font-family: inherit; transition: all .2s;
      text-decoration: none; display: inline-block;
    }
    .btn-view-policy:hover { background: var(--blue2); color: #fff; }

    /* â”€â”€ Upload Center â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .upload-box {
      background: var(--surface);
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 2.5rem;
      text-align: center;
      margin-bottom: 1.5rem;
      transition: border-color .2s;
    }
    .upload-box:hover { border-color: var(--blue2); }
    .upload-box .upload-icon { font-size: 2.5rem; margin-bottom: .75rem; }
    .upload-box h3 { font-size: 1.125rem; font-weight: 700; color: var(--blue); margin-bottom: .5rem; }
    .upload-box p  { color: var(--muted); font-size: .875rem; margin-bottom: 1.25rem; }
    .btn-primary {
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color: #fff; border: none; border-radius: 10px;
      padding: .75rem 1.5rem; font-size: .9375rem; font-weight: 700;
      font-family: inherit; cursor: pointer; transition: all .2s;
      display: inline-flex; align-items: center; gap: .5rem;
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, var(--blue2), var(--blue3));
      transform: translateY(-1px);
      box-shadow: 0 4px 14px rgba(0,51,102,.3);
    }
    .instructions-box {
      background: rgba(0,51,102,.04);
      border: 1px solid rgba(0,51,102,.15);
      border-radius: var(--radius);
      padding: 1.25rem 1.5rem;
    }
    .instructions-box h4 { font-size: .9375rem; font-weight: 700; color: var(--blue); margin-bottom: .75rem; }
    .instructions-box ol { padding-left: 1.25rem; }
    .instructions-box li { font-size: .875rem; color: var(--text); line-height: 1.7; }

    /* â”€â”€ Concern Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .concern-split {
      display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;
      margin-bottom: 1.5rem;
    }
    .concern-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
    }
    .concern-card h3 { font-size: 1rem; font-weight: 700; margin-bottom: .5rem; }
    .concern-card p  { font-size: .875rem; color: var(--muted); margin-bottom: 1rem; line-height: 1.5; }
    .concern-card .btn-primary { font-size: .875rem; padding: .625rem 1.25rem; }

    /* â”€â”€ Concern Board â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .board-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1rem; flex-wrap: wrap; gap: .75rem;
    }
    .board-note {
      background: rgba(245,166,35,.08);
      border: 1px solid rgba(245,166,35,.3);
      border-radius: 8px; padding: .75rem 1rem;
      font-size: .8125rem; color: #6b4c00;
      margin-bottom: 1.25rem;
    }
    .concern-table-wrap {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow-x: auto;
    }
    .concern-table {
      width: 100%; border-collapse: collapse; font-size: .875rem;
    }
    .concern-table th {
      background: rgba(0,51,102,.06); padding: .75rem 1rem;
      text-align: left; font-size: .75rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .04em; color: var(--blue);
      border-bottom: 2px solid var(--border);
    }
    .concern-table td {
      padding: .75rem 1rem; border-bottom: 1px solid var(--border); vertical-align: top;
    }
    .concern-table tr:last-child td { border-bottom: none; }

    /* â”€â”€ Stats row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem; margin-bottom: 1.5rem;
    }
    .stat-tile {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 1.1rem 1.25rem;
    }
    .stat-tile .tile-label { font-size: .75rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .04em; }
    .stat-tile .tile-value { font-size: 1.75rem; font-weight: 800; color: var(--blue); margin-top: .25rem; }
    .stat-tile .tile-sub   { font-size: .75rem; color: var(--muted); margin-top: .125rem; }

    /* â”€â”€ Dept-gated view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .restricted-banner {
      background: rgba(220,53,69,.06);
      border: 1px solid rgba(220,53,69,.2);
      border-radius: var(--radius);
      padding: 1.5rem;
      text-align: center;
    }
    .restricted-banner .r-icon { font-size: 2.5rem; margin-bottom: .75rem; }
    .restricted-banner h3 { font-weight: 700; color: var(--red); margin-bottom: .5rem; }
    .restricted-banner p  { font-size: .875rem; color: var(--muted); }

    /* â”€â”€ Leadership View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .leadership-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    .leadership-card {
      background: linear-gradient(135deg, var(--blue) 0%, var(--blue2) 100%);
      color: #fff;
      border-radius: var(--radius);
      padding: 1.5rem;
    }
    .leadership-card h3 { font-size: 1.0625rem; font-weight: 700; margin-bottom: .5rem; }
    .leadership-card p  { font-size: .875rem; opacity: .8; line-height: 1.55; }

    /* â”€â”€ Alert boxes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .alert { border-radius: 8px; padding: .875rem 1rem; font-size: .875rem; margin-bottom: 1rem; }
    .alert-info  { background: rgba(0,77,153,.06); border: 1px solid rgba(0,77,153,.2); color: var(--blue); }
    .alert-warn  { background: rgba(253,126,20,.08); border: 1px solid rgba(253,126,20,.25); color: #7d3c0a; }

    /* â”€â”€ Dept color accents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    [data-dept="hr"]           .dept-accent { background: #e53e3e; }
    [data-dept="finance"]      .dept-accent { background: #38a169; }
    [data-dept="programming"]  .dept-accent { background: #3182ce; }
    [data-dept="data"]         .dept-accent { background: var(--purple); }
    [data-dept="training"]     .dept-accent { background: var(--teal); }
    [data-dept="leadership"]   .dept-accent { background: var(--gold); }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      .ct-layout { grid-template-columns: 1fr; }
      .ct-sidebar {
        position: static; height: auto;
        display: flex; flex-wrap: wrap;
        padding: .5rem; gap: .25rem;
        border-right: none; border-bottom: 1px solid var(--border);
      }
      .sidebar-section-label { display: none; }
      .sidebar-divider { display: none; }
      .sidebar-link { width: auto; padding: .5rem .75rem; font-size: .8125rem; }
      .ct-main { padding: 1rem; }
      .concern-split { grid-template-columns: 1fr; }
    }
  </style>

  /* â”€â”€ Multi-step Concern Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .form-steps {
    display: flex; align-items: center; gap: .5rem;
    margin-bottom: 2rem; flex-wrap: wrap;
  }
  .form-step {
    font-size: .75rem; font-weight: 700; padding: .375rem .875rem;
    border-radius: 20px; background: var(--border); color: var(--muted);
    transition: all .2s; cursor: default;
  }
  .form-step.active  { background: var(--blue); color: #fff; }
  .form-step.completed { background: rgba(40,167,69,.15); color: #155724; }
  .form-step-divider { color: var(--muted); font-size: .75rem; }
  .form-section-block { display: none; }
  .form-section-block.active { display: block; }
  .section-title {
    font-size: 1.0625rem; font-weight: 700; color: var(--blue);
    margin-bottom: 1.25rem; padding-bottom: .625rem;
    border-bottom: 2px solid var(--border);
  }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  @media (max-width: 640px) { .form-row { grid-template-columns: 1fr; } }
  .form-group { margin-bottom: 1.125rem; }
  .form-lbl { display: block; font-size: .875rem; font-weight: 600; color: var(--text); margin-bottom: .375rem; }
  .form-lbl.required::after { content: ' *'; color: var(--red); }
  .form-hint { font-size: .75rem; color: var(--muted); margin-bottom: .5rem; margin-top: -.25rem; }
  .form-ctrl {
    width: 100%; padding: .75rem .875rem;
    font-size: .9375rem; font-family: inherit;
    border: 1.5px solid var(--border); border-radius: 10px;
    outline: none; background: var(--surface);
    transition: border-color .2s, box-shadow .2s;
  }
  .form-ctrl:focus { border-color: var(--blue2); box-shadow: 0 0 0 3px rgba(0,77,153,.08); }
  textarea.form-ctrl { resize: vertical; min-height: 100px; }
  .radio-group { display: flex; flex-wrap: wrap; gap: .625rem; }
  .radio-group.vertical { flex-direction: column; gap: .5rem; }
  .radio-opt {
    display: flex; align-items: center; gap: .5rem;
    font-size: .875rem; cursor: pointer; padding: .375rem .75rem;
    border: 1.5px solid var(--border); border-radius: 8px;
    background: var(--surface); transition: all .15s;
  }
  .radio-opt:hover { border-color: var(--blue2); background: rgba(0,77,153,.04); }
  .radio-opt input[type="radio"] { accent-color: var(--blue2); }
  .step-actions {
    display: flex; justify-content: flex-end; gap: .75rem;
    margin-top: 1.75rem; padding-top: 1.25rem;
    border-top: 1px solid var(--border);
  }
  .btn-back {
    background: var(--surface); border: 1.5px solid var(--border);
    color: var(--text); border-radius: 10px;
    padding: .75rem 1.5rem; font-size: .9375rem; font-weight: 600;
    font-family: inherit; cursor: pointer; transition: all .2s;
  }
  .btn-back:hover { border-color: var(--blue2); color: var(--blue2); }
  .btn-next {
    background: linear-gradient(135deg, var(--blue2), var(--blue3));
    color: #fff; border: none; border-radius: 10px;
    padding: .75rem 1.75rem; font-size: .9375rem; font-weight: 700;
    font-family: inherit; cursor: pointer; transition: all .2s;
  }
  .btn-next:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(0,77,153,.3); }
  .btn-submit {
    background: linear-gradient(135deg, #155724, #28a745);
    color: #fff; border: none; border-radius: 10px;
    padding: .75rem 2rem; font-size: .9375rem; font-weight: 700;
    font-family: inherit; cursor: pointer; transition: all .2s;
    display: inline-flex; align-items: center; gap: .5rem;
  }
  .btn-submit:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(40,167,69,.3); }
  .btn-submit:disabled { opacity: .6; cursor: not-allowed; transform: none; }
  .btn-spinner {
    width: 16px; height: 16px;
    border: 2px solid rgba(255,255,255,.3);
    border-top-color: #fff; border-radius: 50%;
    animation: spin .6s linear infinite;
  }
  .submit-confirm-box {
    display: flex; align-items: flex-start; gap: .75rem;
    background: rgba(40,167,69,.06); border: 1px solid rgba(40,167,69,.2);
    border-radius: 10px; padding: 1rem 1.25rem;
    font-size: .875rem; color: #155724; line-height: 1.5;
  }
  .submit-error {
    background: rgba(220,53,69,.08); border: 1px solid rgba(220,53,69,.2);
    border-radius: 8px; padding: .75rem 1rem;
    font-size: .875rem; color: var(--red); margin-bottom: 1rem;
  }
  .success-card {
    text-align: center; padding: 3rem 2rem;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius);
  }
  .success-card .success-icon { font-size: 3rem; margin-bottom: 1rem; }
  .success-card h3 { font-size: 1.375rem; font-weight: 800; color: var(--blue); margin-bottom: .75rem; }
  .success-card p { color: var(--muted); font-size: .9375rem; line-height: 1.6; }
  /* Drive doc library */
  .drive-admin-note {
    background: rgba(245,166,35,.08); border: 1px solid rgba(245,166,35,.3);
    border-radius: 8px; padding: .875rem 1rem; font-size: .8125rem;
    color: #6b4c00; margin-bottom: 1.25rem;
  }
</style>
</head>
<body>

  <!-- â”€â”€ Top Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="ct-nav">
    <div class="nav-brand">
      <div class="nav-logo">NJTC</div>
      <h1>Central Team Portal</h1>
    </div>
    <div class="nav-actions">
      <span class="nav-dept-badge" id="deptBadge">Loadingâ€¦</span>
      <span class="session-timer" id="sessionTimer"></span>
      <button class="btn-logout" onclick="NJTCAuth.logout()">Sign Out</button>
    </div>
  </nav>

  <!-- â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="ct-layout" id="ctLayout" style="display:none">

    <!-- Sidebar -->
    <aside class="ct-sidebar">
      <span class="sidebar-section-label">Navigation</span>
      <button class="sidebar-link active" data-panel="home" onclick="showPanel('home', this)">
        <span class="sidebar-icon">ğŸ </span> Department Home
      </button>
      <button class="sidebar-link" data-panel="kpi" onclick="showPanel('kpi', this)">
        <span class="sidebar-icon">ğŸ“Š</span> KPI Targets
      </button>
      <button class="sidebar-link" data-panel="policies" onclick="showPanel('policies', this)">
        <span class="sidebar-icon">ğŸ“</span> Policies Library
      </button>

      <div class="sidebar-divider"></div>
      <span class="sidebar-section-label">Reporting</span>

      <button class="sidebar-link" data-panel="concern-program" onclick="showPanel('concern-program', this)">
        <span class="sidebar-icon">âš ï¸</span> Program Concerns
      </button>
      <button class="sidebar-link" data-panel="concern-perf" onclick="showPanel('concern-perf', this)">
        <span class="sidebar-icon">ğŸ‘¤</span> Performance Concerns
      </button>

      <div class="sidebar-divider"></div>
      <span class="sidebar-section-label">Documents</span>

      <button class="sidebar-link" data-panel="upload" onclick="showPanel('upload', this)">
        <span class="sidebar-icon">ğŸ“¤</span> Upload Center
      </button>
    </aside>

    <!-- Main content -->
    <main class="ct-main">

      <!-- â•â• HOME PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel active" id="panel-home">
        <div class="page-header">
          <h2 id="homeTitle">Department Home</h2>
          <p id="homeSubtitle">Quick access to your department's key tools and resources.</p>
        </div>

        <!-- KPI Summary stats -->
        <div class="stats-row" id="kpiSummaryRow">
          <!-- Populated by JS -->
        </div>

        <!-- Quick links â€” populated per dept -->
        <div class="cards-grid" id="quickLinksGrid">
          <!-- Populated by JS -->
        </div>

        <!-- Alert: annual goal banner -->
        <div class="alert alert-info" id="goalAlertBanner">
          <strong>ğŸ¯ Annual Goal Alignment:</strong> All work in the portal connects to NJTC's organizational targets.
          Visit <strong>KPI Targets</strong> to see current progress across all goals.
        </div>
      </div>

      <!-- â•â• KPI PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-kpi">
        <div class="page-header">
          <h2>KPI Targets â€” SY 25-26</h2>
          <p>Read-only view of organizational goal targets. Status reflects mid-cycle reporting.</p>
        </div>
        <div class="kpi-filters">
          <select id="kpiGoalFilter" onchange="filterKPI()">
            <option value="">All Goals</option>
          </select>
          <select id="kpiStatusFilter" onchange="filterKPI()">
            <option value="">All Statuses</option>
            <option value="Met">Met</option>
            <option value="In Progress">In Progress</option>
            <option value="Partially Met">Partially Met</option>
            <option value="Coming Down the Pipeline">Pipeline</option>
            <option value="Has Not Met">Has Not Met</option>
          </select>
          <input type="text" id="kpiSearch" placeholder="Search targetsâ€¦" oninput="filterKPI()" style="min-width:200px">
        </div>
        <div class="kpi-table-wrap">
          <table class="kpi-table" id="kpiTable">
            <thead>
              <tr>
                <th style="width:30%">Annual Goal</th>
                <th>Target</th>
                <th style="width:140px">Mid-Cycle Status</th>
              </tr>
            </thead>
            <tbody id="kpiTbody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- â•â• POLICIES PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

      <!-- â•â• POLICIES PANEL â€” Drive-powered â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-policies">
        <div class="page-header">
          <h2>Policies & Procedures Library</h2>
          <p>Official NJTC documents. Click any document to open it in Google Drive.</p>
        </div>
        <div class="drive-admin-note" id="driveAdminNote" style="display:none">
          âš™ï¸ <strong>Admin:</strong> To add documents, update <code>manifest.json</code> in your Google Drive folder and paste each file's Drive ID. Documents appear here automatically.
        </div>
        <div class="policy-filters">
          <select id="policyDeptFilter" onchange="filterPolicies()">
            <option value="">All Departments</option>
            <option value="hr">Human Resources</option>
            <option value="finance">Finance</option>
            <option value="programming">Programming</option>
            <option value="data">Data & Evaluation</option>
            <option value="training">Training & Development</option>
            <option value="all">Organization-Wide</option>
          </select>
          <input type="text" id="policySearch" placeholder="Search policiesâ€¦" oninput="filterPolicies()"
            style="min-width:200px; padding:.5rem .875rem; font-size:.875rem; border:1px solid var(--border); border-radius:8px;">
        </div>
        <div class="policy-grid" id="policyGrid"></div>
        <div id="policyEmpty" style="display:none" class="alert alert-info">No documents match your filter.</div>
      </div>

      <!-- â•â• CONCERN FORM PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-concern-program">
        <div class="page-header">
          <h2>Performance & Program Concern Form</h2>
          <p>Document a performance conversation or program concern. Submitted directly to HR â€” no GitHub required.</p>
        </div>

        <!-- Success screen -->
        <div id="formSuccess" style="display:none">
          <div class="success-card">
            <div class="success-icon">âœ…</div>
            <h3>Submission Received</h3>
            <p>Your concern has been logged and HR has been notified.<br>A confirmation copy has been sent to your email address.</p>
            <button class="btn-primary" onclick="resetConcernForm()" style="margin-top:1.25rem">Submit Another</button>
          </div>
        </div>

        <!-- Form container -->
        <div id="formContainer">
          <form id="concernForm" novalidate>

            <!-- Step indicators -->
            <div class="form-steps">
              <div class="form-step active" data-step="1">1 Â· Submitter</div>
              <div class="form-step-divider">â€º</div>
              <div class="form-step" data-step="2">2 Â· Employee</div>
              <div class="form-step-divider">â€º</div>
              <div class="form-step" data-step="3">3 Â· Concern</div>
              <div class="form-step-divider">â€º</div>
              <div class="form-step" data-step="4">4 Â· Next Steps</div>
            </div>

            <!-- STEP 1: Submitter -->
            <div class="form-section-block active" id="cstep1">
              <h3 class="section-title">Your Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-lbl required">Your Email</label>
                  <input type="email" id="f_email" class="form-ctrl" placeholder="yourname@njtc.org" />
                </div>
                <div class="form-group">
                  <label class="form-lbl required">Your Name & Title</label>
                  <input type="text" id="f_submitter" class="form-ctrl" placeholder="e.g. Jane Smith, Program Manager" />
                </div>
              </div>
              <div class="form-group">
                <label class="form-lbl required">Completing on behalf of someone else?</label>
                <div class="radio-group">
                  <label class="radio-opt"><input type="radio" name="onBehalf" value="No" checked onchange="toggleOnBehalf(this.value)" /> No</label>
                  <label class="radio-opt"><input type="radio" name="onBehalf" value="Yes" onchange="toggleOnBehalf(this.value)" /> Yes</label>
                </div>
              </div>
              <div class="form-group" id="onBehalfField" style="display:none">
                <label class="form-lbl">Name & role of the person you're completing this for</label>
                <input type="text" id="f_onBehalfOf" class="form-ctrl" placeholder="e.g. John Doe, Site Coordinator" />
              </div>
              <div class="step-actions">
                <button type="button" class="btn-next" onclick="goFormStep(2)">Next â€º</button>
              </div>
            </div>

            <!-- STEP 2: Employee -->
            <div class="form-section-block" id="cstep2">
              <h3 class="section-title">Employee Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-lbl required">Employee Name</label>
                  <input type="text" id="f_empName" class="form-ctrl" placeholder="Full name" />
                </div>
                <div class="form-group">
                  <label class="form-lbl required">Employee Role</label>
                  <select id="f_empRole" class="form-ctrl">
                    <option value="">Select roleâ€¦</option>
                    <option>Tutor</option><option>SC</option><option>IC</option>
                    <option>Dual Role</option><option>Other</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="form-lbl required">Employee Site / Location</label>
                <select id="f_empSite" class="form-ctrl">
                  <option value="">Select siteâ€¦</option>
                  <option>Clinton Township School District - Round Valley School</option>
                  <option>First Philadelphia Prep Charter School (American Paradigm)</option>
                  <option>Global Leadership Academy - GLA- West</option>
                  <option>Gloucester Township School District- Blackwood Elementary School</option>
                  <option>Gloucester Township School District- Erial Elementary School</option>
                  <option>Gloucester Township School District- JW Lilley Elementary School</option>
                  <option>Gloucester Township School District- Loring Flemming Elementary School</option>
                  <option>Hamilton Township School District- Albert E. Grice Middle School</option>
                  <option>Hamilton Township School District- Crockett Middle School</option>
                  <option>Hamilton Township School District- Kuser Elementary School</option>
                  <option>iLearn Charter School- Bergen ES</option>
                  <option>iLearn Charter School- Bergen MS</option>
                  <option>iLearn Charter School- Clifton ES</option>
                  <option>iLearn Charter School- Clifton HS</option>
                  <option>iLearn Charter School- Clifton MS</option>
                  <option>iLearn Charter School- Hudson ES</option>
                  <option>iLearn Charter School- Hudson MS</option>
                  <option>iLearn Charter School- Passaic ES</option>
                  <option>iLearn Charter School- Passaic MS</option>
                  <option>iLearn Charter School- Paterson ES</option>
                  <option>iLearn Charter School- Paterson MS</option>
                  <option>Lawrence Township- Eldridge Park School</option>
                  <option>Lawrence Township- Slackwood Elementary</option>
                  <option>Monmouth County BGC- Bradley Elementary School</option>
                  <option>Monmouth County BGC- College Achieve (CAPS Neptune)</option>
                  <option>Paterson Charter School Science & Tech.- PCSST 4-7 Campus</option>
                  <option>Pemberton- Denbo-Crichton Location</option>
                  <option>Riverton School District- Riverton Public School</option>
                  <option>Waterford Township School District- Atco Elementary School</option>
                  <option>Waterford Township School District- Waterford Elementary School</option>
                  <option>Penns Grove - Carneys Point Regional School District- Penns Grove Middle School</option>
                  <option>Salem City School District- Salem - John Fenwick Academy (K-2)</option>
                  <option>Salem City School District- Salem Middle School (3-5)</option>
                  <option>Hamilton Township School District- Mercerville Elementary School</option>
                  <option>Hamilton Township School District- Sayen Elementary School</option>
                  <option>Hamilton Township School District-Alexander Elementary School</option>
                  <option>Haddon Township School District-Van Sciver Elementary School</option>
                  <option>Haddon Township School District-Strawbridge Elementary School</option>
                  <option>Haddon Township School District-Edison Elementary School</option>
                  <option>Haddon Township School District-Clyde Jennings Elementary School</option>
                  <option>Haddon Township School District- Stoy Elementary School</option>
                  <option>Central Jersey College Prep</option>
                  <option>Penns Grove - P.W. Carleton Elementary</option>
                  <option>Penns Grove - Field Street Elementary</option>
                  <option>Hoboken Dual Language Charter School (HOLA) - ES</option>
                  <option>Hoboken Dual Language Charter School (HOLA) - MS</option>
                </select>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-lbl required">Today's Date</label>
                  <input type="date" id="f_todayDate" class="form-ctrl" />
                </div>
                <div class="form-group">
                  <label class="form-lbl required">Date Conversation Occurred</label>
                  <input type="date" id="f_convDate" class="form-ctrl" />
                </div>
              </div>
              <div class="form-group">
                <label class="form-lbl required">First documented occurrence for this employee?</label>
                <div class="radio-group">
                  <label class="radio-opt"><input type="radio" name="firstOccurrence" value="Yes" /> Yes</label>
                  <label class="radio-opt"><input type="radio" name="firstOccurrence" value="No" /> No</label>
                </div>
              </div>
              <div class="step-actions">
                <button type="button" class="btn-back" onclick="goFormStep(1)">â€¹ Back</button>
                <button type="button" class="btn-next" onclick="goFormStep(3)">Next â€º</button>
              </div>
            </div>

            <!-- STEP 3: Concern Details -->
            <div class="form-section-block" id="cstep3">
              <h3 class="section-title">Concern Details</h3>
              <div class="form-group">
                <label class="form-lbl required">Type of support being documented</label>
                <div class="radio-group vertical">
                  <label class="radio-opt"><input type="radio" name="supportType" value="Observation by PM Team" /> Observation by PM Team</label>
                  <label class="radio-opt"><input type="radio" name="supportType" value="Additional Coaching Support" /> Additional Coaching Support</label>
                  <label class="radio-opt"><input type="radio" name="supportType" value="Reminder/Verbal Warning" /> Reminder / Verbal Warning</label>
                  <label class="radio-opt"><input type="radio" name="supportType" value="Other" /> Other</label>
                </div>
              </div>
              <div class="form-group" id="supportOtherField" style="display:none">
                <label class="form-lbl">Describe support type (if Other)</label>
                <input type="text" id="f_supportOther" class="form-ctrl" placeholder="Describeâ€¦" />
              </div>
              <div class="form-group">
                <label class="form-lbl required">How was this conversation delivered?</label>
                <div class="radio-group">
                  <label class="radio-opt"><input type="radio" name="delivery" value="In Person" /> In Person</label>
                  <label class="radio-opt"><input type="radio" name="delivery" value="Email" /> Email</label>
                  <label class="radio-opt"><input type="radio" name="delivery" value="Phone" /> Phone</label>
                  <label class="radio-opt"><input type="radio" name="delivery" value="Text Message" /> Text</label>
                  <label class="radio-opt"><input type="radio" name="delivery" value="ZOOM meeting" /> Zoom</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-lbl required">Type of concern</label>
                <div class="radio-group vertical">
                  <label class="radio-opt"><input type="radio" name="concernType" value="Attendance" /> Attendance</label>
                  <label class="radio-opt"><input type="radio" name="concernType" value="Lesson Plans" /> Lesson Plans</label>
                  <label class="radio-opt"><input type="radio" name="concernType" value="Overall Lesson Delivery" /> Overall Lesson Delivery</label>
                  <label class="radio-opt"><input type="radio" name="concernType" value="Timecard incident" /> Timecard Incident</label>
                  <label class="radio-opt"><input type="radio" name="concernType" value="Other" /> Other</label>
                </div>
              </div>
              <div class="form-group" id="concernOtherField" style="display:none">
                <label class="form-lbl">Explain concern context (if Other)</label>
                <input type="text" id="f_concernOther" class="form-ctrl" placeholder="Describeâ€¦" />
              </div>
              <div class="form-group">
                <label class="form-lbl required">Relevant historical details</label>
                <p class="form-hint">Include dates, previous feedback, details from this conversation, and any support offered.</p>
                <textarea id="f_history" class="form-ctrl" rows="5" placeholder="Provide full context hereâ€¦"></textarea>
              </div>
              <div class="step-actions">
                <button type="button" class="btn-back" onclick="goFormStep(2)">â€¹ Back</button>
                <button type="button" class="btn-next" onclick="goFormStep(4)">Next â€º</button>
              </div>
            </div>

            <!-- STEP 4: Next Steps -->
            <div class="form-section-block" id="cstep4">
              <h3 class="section-title">Next Steps</h3>
              <div class="form-group">
                <label class="form-lbl required">Next steps requested from HR</label>
                <div class="radio-group vertical">
                  <label class="radio-opt"><input type="radio" name="hrNextSteps" value="On Watch" /> On Watch</label>
                  <label class="radio-opt"><input type="radio" name="hrNextSteps" value="First Write Up - Employee Progress Report" /> First Write Up â€” Employee Progress Report</label>
                  <label class="radio-opt"><input type="radio" name="hrNextSteps" value="Second Progress Report Report Needed" /> Second Progress Report Needed</label>
                  <label class="radio-opt"><input type="radio" name="hrNextSteps" value="PGP" /> PGP (Performance Growth Plan)</label>
                  <label class="radio-opt"><input type="radio" name="hrNextSteps" value="Recommended Termination" /> Recommended Termination</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-lbl">Additional context or next steps for HR</label>
                <textarea id="f_nextStepsDesc" class="form-ctrl" rows="4" placeholder="Any additional details for HRâ€¦"></textarea>
              </div>
              <div class="form-group">
                <div class="submit-confirm-box">
                  <span>âœ…</span>
                  <span>I confirm this information is accurate and understand it will be submitted directly to HR.</span>
                </div>
              </div>
              <div id="submitError" class="submit-error" style="display:none"></div>
              <div class="step-actions">
                <button type="button" class="btn-back" onclick="goFormStep(3)">â€¹ Back</button>
                <button type="button" class="btn-submit" id="submitBtn" onclick="submitConcernForm()">
                  <span id="submitBtnText">Submit to HR</span>
                  <div class="btn-spinner" id="submitSpinner" style="display:none"></div>
                </button>
              </div>
            </div>

          </form>
        </div>
      </div>

      <!-- â•â• PERF CONCERNS (redirect to main form) â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-concern-perf">
        <div class="page-header">
          <h2>Performance Concern Reporting</h2>
          <p>Use the concern form to document performance conversations. HR and Leadership have full access to all submissions.</p>
        </div>
        <div class="info-card" style="max-width:480px">
          <div class="info-card-icon">ğŸ“</div>
          <h3>Submit a Performance Concern</h3>
          <p>The performance concern form is combined with program concerns for a streamlined experience.</p>
          <button class="btn-primary" style="margin-top:.75rem" onclick="showPanel('concern-program', document.querySelector('[data-panel=concern-program]'))">
            Open Concern Form â†’
          </button>
        </div>
      </div>

      <!-- â•â• UPLOAD CENTER (Drive-based) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-upload">
        <div class="page-header">
          <h2>Document Upload Center</h2>
          <p>Submit documents to the NJTC policy library via Google Drive.</p>
        </div>
        <div class="upload-box">
          <div class="upload-icon">ğŸ“</div>
          <h3>Upload to Google Drive</h3>
          <p>All NJTC policy documents are managed in Google Drive. Admins upload files directly to the shared folder, and they appear in the Policies Library automatically.</p>
          <a class="btn-primary" href="https://drive.google.com/drive/folders/1AflTMfemn1NuRK95PnBJk5a1b6QTPeiG" target="_blank" rel="noopener">
            Open NJTC Drive Folder â†—
          </a>
        </div>
        <div class="instructions-box">
          <h4>How to Add a Document to the Library</h4>
          <ol>
            <li>Upload your PDF or document to the NJTC Google Drive folder above.</li>
            <li>Right-click the file â†’ Share â†’ change to "Anyone with the link (Viewer)".</li>
            <li>Copy the File ID from the share URL (the long string between /d/ and /view).</li>
            <li>Open <code>manifest.json</code> in the Drive folder and add a new entry with the title, department, date, description, and file ID.</li>
            <li>The document will appear in the Policies Library within minutes.</li>
          </ol>
        </div>
      </div>

    </main>
  </div>

  <!-- Loading screen -->
  <div id="loadingScreen" style="position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:9999;">
    <div style="text-align:center">
      <div style="font-size:2rem;margin-bottom:.75rem">ğŸ”</div>
      <p style="color:var(--muted);font-size:.9375rem">Verifying accessâ€¦</p>
    </div>
  </div>

<script src="../auth/auth.js?v=3"></script>
<script src="../auth/central-guard.js?v=3"></script>
  <script>

  // â”€â”€ Dept config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DEPT_CONFIG = {
    hr: {
      label: 'Human Resources',
      emoji: 'ğŸ‘”',
      subtitle: 'Protecting the organization and our people.',
      quickLinks: [
        { icon: 'ğŸ“‹', title: 'Performance Concern Form', desc: 'Document a performance conversation.', action: () => showPanel('concern-perf', document.querySelector('[data-panel="concern-perf"]')) },
        { icon: 'ğŸ“', title: 'HR Policies', desc: 'Access all HR policies and procedures.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“Š', title: 'KPI: Culture Goals', desc: 'Staff retention and diversity targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'Review escalations requiring HR action.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
      ]
    },
    finance: {
      label: 'Finance',
      emoji: 'ğŸ’°',
      subtitle: 'Maintaining fiscal health and accountability.',
      quickLinks: [
        { icon: 'ğŸ“Š', title: 'KPI: Funding Goals', desc: 'Philanthropic and fee-for-service targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“', title: 'Finance Policies', desc: 'Budget procedures and financial guidelines.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“¤', title: 'Upload Reports', desc: 'Upload financial reports to the docs library.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
      ]
    },
    programming: {
      label: 'Programming',
      emoji: 'ğŸ¯',
      subtitle: 'Delivering high-quality instructional programs.',
      quickLinks: [
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'Log and review site-level concerns.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
        { icon: 'ğŸ“Š', title: 'KPI: Scholar Impact', desc: 'Scholar growth and site targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“', title: 'Programming Policies', desc: 'Site operations and program procedures.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“¤', title: 'Upload Site Docs', desc: 'Submit program-related documents.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
      ]
    },
    data: {
      label: 'Data & Evaluation',
      emoji: 'ğŸ“ˆ',
      subtitle: 'Driving decisions through rigorous data.',
      quickLinks: [
        { icon: 'ğŸ“Š', title: 'Full KPI Dashboard', desc: 'Review all organizational targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“¤', title: 'Upload Data Reports', desc: 'Submit evaluation CSVs or reports.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
        { icon: 'ğŸ“', title: 'Data Governance Docs', desc: 'Data policies and reporting frameworks.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
      ]
    },
    training: {
      label: 'Training & Development',
      emoji: 'ğŸ“',
      subtitle: 'Building staff capacity and growth.',
      quickLinks: [
        { icon: 'ğŸ“', title: 'Training Materials', desc: 'Policies and procedures for PD.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
        { icon: 'ğŸ“Š', title: 'KPI: Pipeline Goals', desc: 'Educator pipeline and apprenticeship targets.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'ğŸ“¤', title: 'Upload PD Docs', desc: 'Submit training materials.', action: () => showPanel('upload', document.querySelector('[data-panel=upload]')) },
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'Training-related site concerns.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
      ]
    },
    leadership: {
      label: 'Leadership',
      emoji: 'â­',
      subtitle: 'Organizational oversight and strategic direction.',
      quickLinks: [
        { icon: 'ğŸ“Š', title: 'KPI Targets', desc: 'Full organizational goal overview.', action: () => showPanel('kpi', document.querySelector('[data-panel=kpi]')) },
        { icon: 'âš ï¸', title: 'Program Concerns', desc: 'All open program concern issues.', action: () => showPanel('concern-program', document.querySelector('[data-panel="concern-program"]')) },
        { icon: 'ğŸ‘¤', title: 'Performance Board', desc: 'HR triage board â€” full access.', action: () => showPanel('concern-perf', document.querySelector('[data-panel="concern-perf"]')) },
        { icon: 'ğŸ“', title: 'All Policies', desc: 'Organization-wide policy library.', action: () => showPanel('policies', document.querySelector('[data-panel=policies]')) },
      ]
    }
  };

  // â”€â”€ KPI Data (from CSV) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const KPI_DATA = [
    { goal: 'Increase Impact on Scholars', target: 'Serve 2,000 scholars annually by 2026', status: 'Partially Met' },
    { goal: 'Increase Impact on Scholars', target: 'Serve 35 sites annually by 2026', status: 'Met' },
    { goal: 'Increase Impact on Scholars', target: 'Placement Level Change: 80% of scholars advancing a level in math or ELA', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: 'Math: 20% increase of scholars reaching grade-level proficiency', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: 'ELA: 20% increase of scholars reaching grade-level proficiency', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: 'Gap Closing: 35% decrease in scholars 2+ grade levels below', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: '80% of scholars self-report increased confidence in ELA', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: '80% of scholars self-report increased confidence in Math', status: 'In Progress' },
    { goal: 'Increase Impact on Scholars', target: '92% of onsite staff observe scholar growth', status: 'In Progress' },
    { goal: 'Educator Pipeline', target: '40 tutor apprentices for SY 25-26', status: 'In Progress' },
    { goal: 'Educator Pipeline', target: 'Secure 1 DOL grant to expand apprenticeship program', status: 'Met' },
    { goal: 'Educator Pipeline', target: '4 NJTC apprentices join Teacher Apprenticeship Network (TAN) in 2026', status: 'Coming Down the Pipeline' },
    { goal: 'Fee-for-Service Growth', target: '35 SY sites â€” all fee-for-service', status: 'Met' },
    { goal: 'Fee-for-Service Growth', target: 'Secure 3 new low-cost pilot customers using new grant funds', status: 'In Progress' },
    { goal: 'Fee-for-Service Growth', target: '75% of sites cover full fee-for-service', status: 'Met' },
    { goal: 'Fee-for-Service Growth', target: 'Add 1 additional out-of-state customer', status: 'Met' },
    { goal: 'Fee-for-Service Growth', target: 'Apply to at least 10 local/regional RFPs annually', status: 'Partially Met' },
    { goal: 'Funding', target: 'Identify and apply to 2 new multi-year or $500K+ funding opportunities', status: 'Met' },
    { goal: 'Funding', target: 'Secure $850,000 in philanthropic funds', status: 'Met' },
    { goal: 'Funding', target: 'Secure new philanthropic partners totaling $200K', status: 'Has Not Met' },
    { goal: 'Funding', target: 'Secure support from FY27 State budget', status: 'Coming Down the Pipeline' },
    { goal: 'Financial Health', target: 'Maintain $500K in money market by end of 2025', status: 'Met' },
    { goal: 'Board Development', target: 'At least 1 board member introduction per member (15 total) to partners/donors', status: 'In Progress' },
    { goal: 'Board Development', target: 'Maintain 100% board giving; increase total by 10%', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: 'Revised performance evaluation system in place by November 2025', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: 'KPI Dashboard 100% operational by October 2025', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: '2025-2026 Program Evaluation completed by August 2026', status: 'Coming Down the Pipeline' },
    { goal: 'Systems & Infrastructure', target: 'NJTC Annual Report sent to stakeholders by December 2025', status: 'Partially Met' },
    { goal: 'Systems & Infrastructure', target: 'Data Governance documented for all internal reporting by December 2025', status: 'Met' },
    { goal: 'Systems & Infrastructure', target: 'Annual Budgeting process completed by August 1, 2026', status: 'Coming Down the Pipeline' },
    { goal: 'Systems & Infrastructure', target: 'Leadership completes Mid-Year and End-of-Year retreat', status: 'Coming Down the Pipeline' },
    { goal: 'Partner Experience', target: '90% customer satisfaction at end of SY 25-26', status: 'In Progress' },
    { goal: 'Partner Experience', target: 'Receive 3 referrals from partners', status: 'Met' },
    { goal: 'Partner Experience', target: '50% retention rate for school partners', status: 'Coming Down the Pipeline' },
    { goal: 'Culture', target: '80% annual core staff retention', status: 'Met' },
    { goal: 'Culture', target: '60% annual on-site staff retention', status: 'Has Not Met' },
    { goal: 'Culture', target: 'Increase diversity of tutors to mirror student diversity', status: 'Met' },
    { goal: 'Culture', target: 'Host 2 in-person events for central team (Winter and Summer)', status: 'Partially Met' },
    { goal: 'Brand Growth', target: '10 local media hits per year', status: 'Met' },
    { goal: 'Brand Growth', target: 'Attend 5 local education/non-profit conferences; speak at 2', status: 'Met' },
    { goal: 'Brand Growth', target: 'Participate in 3 national conferences with presentations at 2', status: 'Met' },
    { goal: 'Brand Growth', target: 'Increase social media followers by 20% in aggregate', status: 'Coming Down the Pipeline' },
    { goal: 'Brand Growth', target: 'Meet with at least 7 education organizations across NJ', status: 'In Progress' },
    { goal: 'Brand Growth', target: 'Attend 5 South Jersey Chamber events', status: 'Partially Met' },
  ];


  // â”€â”€ Google Drive Document Library â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // SETUP: Create manifest.json in your Drive folder and paste its file ID below.
  // Get file ID: share the file â†’ copy the ID from the URL between /d/ and /view
  const DRIVE_MANIFEST_ID = 'REPLACE_WITH_YOUR_MANIFEST_JSON_FILE_ID';

  const DOCS_DATA = [
    { title: 'Employee Handbook', dept: 'hr', tag: 'HR', effectiveDate: 'Aug 2025', desc: 'Full NJTC employee handbook covering policies, procedures, and expectations.', file: null },
    { title: 'Data Governance Framework', dept: 'data', tag: 'Data & Evaluation', effectiveDate: 'Dec 2025', desc: 'Internal reporting standards, data ownership, and governance workflows.', file: null },
    { title: 'Performance Evaluation System', dept: 'hr', tag: 'HR', effectiveDate: 'Nov 2025', desc: 'Revised performance evaluation rubrics and process documentation.', file: null },
    { title: 'Program Concern Escalation Protocol', dept: 'programming', tag: 'Programming', effectiveDate: 'Sep 2025', desc: 'Step-by-step guide for escalating site-level program concerns.', file: null },
    { title: 'Budget & Financial Controls', dept: 'finance', tag: 'Finance', effectiveDate: 'Aug 2025', desc: 'Budget procedures, reimbursement policy, and financial accountability guidelines.', file: null },
    { title: 'Training & PD Calendar', dept: 'training', tag: 'Training', effectiveDate: 'Sep 2025', desc: 'Required professional development schedule and compliance tracking.', file: null },
  ];

  // â”€â”€ Google Form submission â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const FORM_ACTION = 'https://docs.google.com/forms/d/e/1FAIpQLSfBqQmfn4ZHyJ1-tv-ehKDyr-zD4RkBr5AfZ2QeJMpJFbFxHg/formResponse';
  const ENTRY = {
    email:           'entry.1457676306',   // Q1  Email
    submitterName:   'entry.580089576',    // Q2  NJTC Employee Name/Title
    onBehalf:        'entry.1590438580',   // Q3  On behalf of someone? (Yes/No)
    onBehalfOf:      'entry.1245652844',   // Q4  On behalf of whom
    empName:         'entry.629932880',    // Q5  Employee Name
    empRole:         'entry.2044182643',   // Q6  Employee Role (SC/Tutor/IC/etc)
    empRoleOther:    'entry.1645253994',   // Q6b Role "Other" text
    todayYear:       'entry.701375141_year',   // Q7 Today's Date
    todayMonth:      'entry.701375141_month',
    todayDay:        'entry.701375141_day',
    convYear:        'entry.651108769_year',   // Q8 Date Conversation Occurred
    convMonth:       'entry.651108769_month',
    convDay:         'entry.651108769_day',
    firstOccurrence: 'entry.1911489470',   // Q9  First documented occurrence? (Yes/No)
    supportType:     'entry.1990325444',   // Q10 Type of support documented
    supportOther:    'entry.59727443',     // Q11 If Other support, describe
    delivery:        'entry.232659604',    // Q12 How conversation delivered
    empSite:         'entry.2070944320',   // Q13 Employee Site/Location
    concernType:     'entry.2109849030',   // Q14 Type of concern
    // Q15, Q16, Q18 are long text fields â€” get their IDs by submitting the live form
    // with all 3 text areas filled in, then check Network tab > formResponse > Payload
    concernOther:    'entry.TODO_Q15',     // Q15 If Other concern, explain
    history:         'entry.TODO_Q16',     // Q16 Historical details (long text)
    hrNextSteps:     'entry.1704854495',   // Q17 HR Next Steps requested
    nextStepsDesc:   'entry.TODO_Q18',     // Q18 Additional next steps description
  };

  let _concernStep = 1;

  function goFormStep(n) {
    if (n > _concernStep && !_validateConcernStep(_concernStep)) return;
    document.getElementById('cstep' + _concernStep).classList.remove('active');
    document.getElementById('cstep' + n).classList.add('active');
    document.querySelectorAll('.form-step').forEach(s => {
      const sn = parseInt(s.dataset.step);
      s.classList.toggle('active', sn === n);
      s.classList.toggle('completed', sn < n);
    });
    _concernStep = n;
    const panel = document.getElementById('panel-concern-program');
    if (panel) window.scrollTo({ top: panel.offsetTop - 80, behavior: 'smooth' });
  }

  function _validateConcernStep(n) {
    const errs = [];
    if (n === 1) {
      if (!document.getElementById('f_email').value.trim()) errs.push('Email is required.');
      if (!document.getElementById('f_submitter').value.trim()) errs.push('Your name/title is required.');
    }
    if (n === 2) {
      if (!document.getElementById('f_empName').value.trim()) errs.push('Employee name is required.');
      if (!document.getElementById('f_empRole').value) errs.push('Employee role is required.');
      if (!document.getElementById('f_empSite').value) errs.push('Employee site is required.');
      if (!document.getElementById('f_todayDate').value) errs.push("Today's date is required.");
      if (!document.getElementById('f_convDate').value) errs.push('Conversation date is required.');
      if (!document.querySelector('input[name="firstOccurrence"]:checked')) errs.push('Please indicate if this is the first documented occurrence.');
    }
    if (n === 3) {
      if (!document.querySelector('input[name="supportType"]:checked')) errs.push('Support type is required.');
      if (!document.querySelector('input[name="delivery"]:checked')) errs.push('Delivery method is required.');
      if (!document.querySelector('input[name="concernType"]:checked')) errs.push('Concern type is required.');
      if (!document.getElementById('f_history').value.trim()) errs.push('Historical details are required.');
    }
    if (errs.length) { alert(errs.join('\n')); return false; }
    return true;
  }

  function toggleOnBehalf(val) {
    document.getElementById('onBehalfField').style.display = val === 'Yes' ? 'block' : 'none';
  }

  function _parseDate(s) {
    const [y, m, d] = (s || '').split('-');
    return { year: y||'', month: m ? String(parseInt(m)) : '', day: d ? String(parseInt(d)) : '' };
  }

  async function submitConcernForm() {
    if (!_validateConcernStep(4)) return;
    if (!document.querySelector('input[name="hrNextSteps"]:checked')) {
      document.getElementById('submitError').textContent = 'Please select HR next steps.';
      document.getElementById('submitError').style.display = 'block';
      return;
    }
    document.getElementById('submitError').style.display = 'none';
    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    document.getElementById('submitBtnText').textContent = 'Submittingâ€¦';
    document.getElementById('submitSpinner').style.display = 'inline-block';

    const td = _parseDate(document.getElementById('f_todayDate').value);
    const cd = _parseDate(document.getElementById('f_convDate').value);
    const params = new URLSearchParams();
    params.append(ENTRY.email,           document.getElementById('f_email').value.trim());
    params.append(ENTRY.submitterName,   document.getElementById('f_submitter').value.trim());
    params.append(ENTRY.onBehalf,        document.querySelector('input[name="onBehalf"]:checked')?.value || 'No');
    params.append(ENTRY.onBehalfOf,      document.getElementById('f_onBehalfOf').value.trim());
    params.append(ENTRY.empName,         document.getElementById('f_empName').value.trim());
    params.append(ENTRY.empRole,         document.getElementById('f_empRole').value);
    params.append(ENTRY.empRoleOther,    document.getElementById('f_empRole').value === 'Other' ? document.getElementById('f_empRole').value : '');
    params.append(ENTRY.todayYear,       td.year);
    params.append(ENTRY.todayMonth,      td.month);
    params.append(ENTRY.todayDay,        td.day);
    params.append(ENTRY.convYear,        cd.year);
    params.append(ENTRY.convMonth,       cd.month);
    params.append(ENTRY.convDay,         cd.day);    params.append(ENTRY.firstOccurrence, document.querySelector('input[name="firstOccurrence"]:checked')?.value || '');
    params.append(ENTRY.supportType,     document.querySelector('input[name="supportType"]:checked')?.value || '');
    params.append(ENTRY.supportOther,    document.getElementById('f_supportOther').value.trim());
    params.append(ENTRY.delivery,        document.querySelector('input[name="delivery"]:checked')?.value || '');
    params.append(ENTRY.empSite,         document.getElementById('f_empSite').value);
    params.append(ENTRY.concernType,     document.querySelector('input[name="concernType"]:checked')?.value || '');
    params.append(ENTRY.concernOther,    document.getElementById('f_concernOther').value.trim());
    params.append(ENTRY.history,         document.getElementById('f_history').value.trim());
    params.append(ENTRY.hrNextSteps,     document.querySelector('input[name="hrNextSteps"]:checked')?.value || '');
    params.append(ENTRY.nextStepsDesc,   document.getElementById('f_nextStepsDesc').value.trim());

    try {
      await fetch(FORM_ACTION, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: params.toString() });
      document.getElementById('formContainer').style.display = 'none';
      document.getElementById('formSuccess').style.display = 'block';
    } catch(e) {
      document.getElementById('submitError').textContent = 'Submission failed. Please try again or contact your Program Manager.';
      document.getElementById('submitError').style.display = 'block';
      btn.disabled = false;
      document.getElementById('submitBtnText').textContent = 'Submit to HR';
      document.getElementById('submitSpinner').style.display = 'none';
    }
  }

  function resetConcernForm() {
    document.getElementById('concernForm').reset();
    document.getElementById('onBehalfField').style.display = 'none';
    document.getElementById('supportOtherField').style.display = 'none';
    document.getElementById('concernOtherField').style.display = 'none';
    document.getElementById('formContainer').style.display = 'block';
    document.getElementById('formSuccess').style.display = 'none';
    document.getElementById('submitBtn').disabled = false;
    document.getElementById('submitBtnText').textContent = 'Submit to HR';
    document.getElementById('submitSpinner').style.display = 'none';
    document.querySelectorAll('.form-step').forEach(s => { s.classList.remove('active','completed'); });
    _concernStep = 1;
    goFormStep(1);
  }

  // Wire radio "other" toggles
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('input[name="supportType"]').forEach(r =>
      r.addEventListener('change', () => {
        document.getElementById('supportOtherField').style.display = r.value === 'Other' ? 'block' : 'none';
      })
    );
    document.querySelectorAll('input[name="concernType"]').forEach(r =>
      r.addEventListener('change', () => {
        document.getElementById('concernOtherField').style.display = r.value === 'Other' ? 'block' : 'none';
      })
    );
  });

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function statusClass(s) {
    switch(s) {
      case 'Met':                      return 'status-met';
      case 'In Progress':              return 'status-progress';
      case 'Partially Met':            return 'status-partial';
      case 'Coming Down the Pipeline': return 'status-pipeline';
      case 'Has Not Met':              return 'status-notmet';
      default:                         return 'status-progress';
    }
  }
  function statusEmoji(s) {
    switch(s) {
      case 'Met':                      return 'âœ…';
      case 'In Progress':              return 'ğŸ”µ';
      case 'Partially Met':            return 'ğŸŸ ';
      case 'Coming Down the Pipeline': return 'ğŸŸ£';
      case 'Has Not Met':              return 'ğŸ”´';
      default:                         return 'âšª';
    }
  }

  // â”€â”€ Panel switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showPanel(id, linkEl) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
    const panel = document.getElementById('panel-' + id);
    if (panel) panel.classList.add('active');
    if (linkEl) linkEl.classList.add('active');
    else {
      const btn = document.querySelector(`[data-panel="${id}"]`);
      if (btn) btn.classList.add('active');
    }
  }

  // â”€â”€ Build KPI table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildKPI() {
    const goals = [...new Set(KPI_DATA.map(k => k.goal))];
    const sel = document.getElementById('kpiGoalFilter');
    goals.forEach(g => {
      const o = document.createElement('option');
      o.value = g; o.textContent = g;
      sel.appendChild(o);
    });
    renderKPI(KPI_DATA);
  }

  function renderKPI(data) {
    const tbody = document.getElementById('kpiTbody');
    tbody.innerHTML = data.map(row => `
      <tr>
        <td><span class="goal-group">${row.goal}</span></td>
        <td>${row.target}</td>
        <td><span class="kpi-status ${statusClass(row.status)}">${statusEmoji(row.status)} ${row.status}</span></td>
      </tr>
    `).join('');
  }

  function filterKPI() {
    const goalF  = document.getElementById('kpiGoalFilter').value;
    const statF  = document.getElementById('kpiStatusFilter').value;
    const search = document.getElementById('kpiSearch').value.toLowerCase();
    const filtered = KPI_DATA.filter(r =>
      (!goalF  || r.goal === goalF) &&
      (!statF  || r.status === statF) &&
      (!search || r.target.toLowerCase().includes(search) || r.goal.toLowerCase().includes(search))
    );
    renderKPI(filtered);
  }

  // â”€â”€ KPI summary stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildKPISummary() {
    const counts = { Met: 0, 'In Progress': 0, 'Partially Met': 0, 'Coming Down the Pipeline': 0, 'Has Not Met': 0 };
    KPI_DATA.forEach(r => counts[r.status] = (counts[r.status] || 0) + 1);
    const row = document.getElementById('kpiSummaryRow');
    row.innerHTML = [
      { label: 'Goals Met', value: counts['Met'],          sub: 'On track',  cls: 'status-met' },
      { label: 'In Progress', value: counts['In Progress'], sub: 'Active',    cls: 'status-progress' },
      { label: 'Partial', value: counts['Partially Met'],   sub: 'Needs attention', cls: 'status-partial' },
      { label: 'Has Not Met', value: counts['Has Not Met'], sub: 'Review needed', cls: 'status-notmet' },
    ].map(t => `
      <div class="stat-tile">
        <div class="tile-label">${t.label}</div>
        <div class="tile-value" style="font-size:1.5rem">${t.value}</div>
        <div class="tile-sub">${t.sub}</div>
      </div>
    `).join('');
  }

  // â”€â”€ Build policies â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function buildPolicies() {

  // â”€â”€ buildPolicies: Google Drive manifest or static fallback â”€â”€
  async function buildPolicies() {
    let docs = DOCS_DATA;

    // Try fetching from Drive manifest
    if (!DRIVE_MANIFEST_ID.startsWith('REPLACE')) {
      try {
        const url = `https://drive.google.com/uc?export=download&id=${DRIVE_MANIFEST_ID}`;
        const res = await fetch(url, { signal: AbortSignal.timeout(5000) });
        if (res.ok) {
          const raw = await res.text();
          const parsed = JSON.parse(raw);
          // Convert fileId â†’ full Drive URL
          docs = parsed.map(d => ({
            ...d,
            file: d.fileId && !d.fileId.startsWith('REPLACE')
              ? `https://drive.google.com/file/d/${d.fileId}/view`
              : null
          }));
          // Show admin note for leadership/hr
          const session = window.NJTC_SESSION;
          if (session && ['hr','leadership','data'].includes(session.dept)) {
            document.getElementById('driveAdminNote').style.display = 'block';
          }
        }
      } catch(e) { /* use static fallback */ }
    }

    window._allDocs = docs;
    renderPolicies(docs);
  }

  function renderPolicies(docs) {
    const grid = document.getElementById('policyGrid');
    if (!docs || docs.length === 0) {
      document.getElementById('policyEmpty').style.display = 'block';
      return;
    }
    grid.innerHTML = docs.map(d => `
      <div class="policy-card" data-dept="${d.dept}" data-title="${d.title.toLowerCase()}">
        <div class="policy-card-header">
          <div class="policy-tag">${d.tag || d.dept}</div>
          <div class="policy-date">${d.effectiveDate}</div>
        </div>
        <h4 class="policy-title">${d.title}</h4>
        <p class="policy-desc">${d.desc}</p>
        ${d.file
          ? `<a class="policy-link" href="${d.file}" target="_blank" rel="noopener">View Document â†—</a>`
          : `<span class="policy-link-disabled">Document coming soon</span>`
        }
      </div>
    `).join('');
  }

  function filterPolicies() {
    const docs = window._allDocs || DOCS_DATA;
    const deptF  = document.getElementById('policyDeptFilter').value;
    const search = document.getElementById('policySearch').value.toLowerCase();
    const filtered = docs.filter(d =>
      (!deptF  || d.dept === deptF) &&
      (!search || d.title.toLowerCase().includes(search) || (d.desc||'').toLowerCase().includes(search))
    );
    if (!filtered.length) {
      document.getElementById('policyGrid').innerHTML = '';
      document.getElementById('policyEmpty').style.display = 'block';
      return;
    }
    document.getElementById('policyEmpty').style.display = 'none';
    renderPolicies(filtered);
  }


  // â”€â”€ Build dept home quick links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildHomeQuickLinks(dept) {
    const config = DEPT_CONFIG[dept] || DEPT_CONFIG['programming'];
    document.getElementById('homeTitle').textContent = config.emoji + ' ' + config.label + ' Home';
    document.getElementById('homeSubtitle').textContent = config.subtitle;

    const grid = document.getElementById('quickLinksGrid');
    grid.innerHTML = config.quickLinks.map(link => `
      <div class="info-card">
        <div class="info-card-icon">${link.icon}</div>
        <h3>${link.title}</h3>
        <p>${link.desc}</p>
        <button class="info-card-link" onclick="(${link.action.toString()})()">
          Go â†’ 
        </button>
      </div>
    `).join('');
  }

  // â”€â”€ Perf concern dept gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setupPerfSection(dept) {
    const canSeeBoard = ['hr', 'leadership'].includes(dept);
    document.getElementById('perfHRBoard').style.display    = canSeeBoard ? 'block' : 'none';
    document.getElementById('perfAccessDenied').style.display = canSeeBoard ? 'none' : 'none'; // form always visible
    document.getElementById('perfFormSection').style.display = 'block';
  }

  // â”€â”€ Session timer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startSessionTimer(exp) {
    function update() {
      const left = exp - Date.now();
      if (left <= 0) { NJTCAuth.logout(); return; }
      const h = Math.floor(left / 3600000);
      const m = Math.floor((left % 3600000) / 60000);
      document.getElementById('sessionTimer').textContent = `Session: ${h}h ${m}m`;
    }
    update();
    setInterval(update, 60000);
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function init() {
    // Wait for central-guard.js to set window.NJTC_SESSION
    await new Promise(resolve => {
      if (window.NJTC_SESSION) { resolve(); return; }
      const t = setInterval(() => {
        if (window.NJTC_SESSION) { clearInterval(t); resolve(); }
      }, 50);
      setTimeout(() => { clearInterval(t); resolve(); }, 3000);
    });

    const session = window.NJTC_SESSION;
    if (!session) return; // guard already redirected

    const dept = session.dept;
    const config = DEPT_CONFIG[dept] || {};

    // Update badge
    document.getElementById('deptBadge').textContent = config.label || dept.toUpperCase();

    // Session timer
    startSessionTimer(session.exp);

    // Build content
    buildHomeQuickLinks(dept);
    buildKPISummary();
    buildKPI();
    buildPolicies();
    setupPerfSection(dept);

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function init() {
    await new Promise(resolve => {
      if (window.NJTC_SESSION) { resolve(); return; }
      const t = setInterval(() => {
        if (window.NJTC_SESSION) { clearInterval(t); resolve(); }
      }, 50);
      setTimeout(() => { clearInterval(t); resolve(); }, 3000);
    });

    const session = window.NJTC_SESSION;
    if (!session) return;

    const dept = session.dept;
    const config = DEPT_CONFIG[dept] || {};

    document.getElementById('deptBadge').textContent = config.label || dept.toUpperCase();
    startSessionTimer(session.exp);

    buildHomeQuickLinks(dept);
    buildKPISummary();
    buildKPI();
    buildPolicies();
    setupPerfSection(dept);

    // Auto-fill today's date in the concern form
    const today = new Date().toISOString().split('T')[0];
    const todayField = document.getElementById('f_todayDate');
    if (todayField) todayField.value = today;

    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('ctLayout').style.display = 'grid';
  }

  init();
  </script>
</body>
</html>
